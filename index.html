


<html>

    <head>
        <style>
  .result{
    flex:auto;
  }
  .selectedL{
    opacity: .3;
  }
  .y_axis path{
    stroke: black;
  }
  .lg{
    margin-left: 20px;
  }
  .legend{
                margin-right: 5px;
            }
  input:focus{
      outline: none;
         }
  #tooltip{
      font:calibri;
      background: whitesmoke;
  }
            body {
                font-family: Helvetica, Arial, sans-serif;
                background-color: #DCDCDC;
            }
            h1 {
                background-color: #2a5599;
                color: white;
                padding: 5px;
                margin-top: -8px;
                margin-left: -8px;
                margin-right: -8px;
                margin-bottom: 0px;
                width: 160%;
            }
            svg {
                border: solid 1px black;
            }
  
            .result{
              padding: 5px;
              margin-bottom: 10px;
              margin-left: 15px;
  
              
            }
            
            .info{
                display: flex;
                margin-bottom: 30px;
            }
             div.tc{
    width: 100px;
    text-align: center;
    color:#616771;
    width: 100px;
    padding: 0 1em;
    line-height: 1.2;
    font-size: .9em;
    vertical-align: top;
    border-right:1px dotted #BDBDBD;
  }
  div.tc1{
    width: 100px;
    text-align: center;
    color:#616771;
    width: 100px;
    padding: 0 1em;
    line-height: 1.2;
    font-size: .9em;
    vertical-align: top;
    border-right:1px dotted #BDBDBD;
  }
  div.tc2{
    width: 100px;
    text-align: center;
    color:#616771;
    width: 100px;
    padding: 0 1em;
    line-height: 1.2;
    font-size: .9em;
    vertical-align: top;
    border-right:1px dotted #BDBDBD;
  }
  div.res{
    height: 20px;
    width: 100%;
    text-align: left;
    color: #616771;
    padding: 0 1em;
    margin-left: 10px;
    line-height: 1.2;
    font-size: 1.2em;
    margin-top: 40px;
    margin-bottom: 0px;
    
  }
  div.res1{
    height: 30px;
    width: 100%;
    text-align: left;
    color:#616771;
    padding: 0 1em;
    margin-left: 10px;
    line-height: 1.2;
    font-size: 1.2em;
    margin-top: 3px;
    
  
  
  }
  
            .mainView {
                display: flex;
                flex-direction: row;
            }
    
            #filter_countries{
    width:15%;
    padding:10px;
    position: absolute;
    right: 0%;
    
  }
  
  #Map{
    background:#DCDCDC;
    margin-left: 0px;
    margin-right: 8px;
  }
  
  #countries-list{
  
    right: 0%;
    overflow: hidden;
    overflow-y:scroll;
    margin-top: 40px;
    padding:5px;
    position: absolute;
    height:450px; width:198px;
    background-color: transparent;
    color: black;
    fill-opacity: .1;
    
  }
  #countries-list li{
    
    position: relative; 
    list-style:none;
    padding:0px;
    margin:5px;
    border: 1px solid #e4e4e4;
   
  }
  #s{
    border: none;
  }
  circle {
    fill-opacity: .55;
    stroke-width: .5;
  }
  label{
    padding: 5px;
    color:#808080;
    font-size: 1.2em;
    
  }
  
  .lasso path {
    stroke: rgb(80,80,80);
    stroke-width:2px;
  }
  
  .lasso .drawn {
    fill-opacity:.05 ;
  }
  
  .lasso .loop_close {
    fill:none;
    stroke-dasharray: 4,4;
  }
  
  .lasso .origin {
    fill:#3399FF;
    fill-opacity:.5;
  }
  
  .not_possible {
    fill:#415679;
    
  }
  
  .possible {
    fill: violet;
  }
  
  .selected {
    fill : yellow;
    fill-opacity: 1;
    stroke: black;
    stroke-width: 1.5;
    opacity: 1;
  }
  
  .selected1 {
    fill : purple;
    fill-opacity: 1;
    stroke: black;
    stroke-width: 1.5;
  }
  
  
  .isselected {
    fill: red;
  }
                                                                            /* previousl 55 */
            div.tooltip {position: absolute; text-align: left; width: 200px; height: 60px; padding: 15px;font: 14px calibri; background: whitesmoke; color:black; border: 2px; border-radius: 8px; pointer-events: none;}
  div.tooltip1{
  
    position: absolute; text-align: left; width: 200px; height: 60px; padding: 15px;font: 14px calibri; background:whitesmoke; color: black; border: 2px; border-radius: 8px; pointer-events: none;
   
  }
  /* 
  .bar {
          fill: steelblue;
          clip-path: url(#clip);
        } */
  #Bar{
    width: 390px;
  }
        #BarChart{
          margin-top: 35px;
          margin-left: -35px;
          margin-right: 0px;
          margin-bottom: 0px;
          background-color: #DCDCDC;
          
        }
  
        #container{
          background-color: #DCDCDC;
        }
          
        .subBar { 
          fill: gray;
          opacity: 0.5;
        }
        
        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }
        
        .brush .extent {
          stroke: #fff;
          fill: steelblue;
          fill-opacity: .25;
          shape-rendering: crispEdges;
        }
        
          rect.mover {
                    stroke: black;
                    stroke-opacity: .5;
                    fill:white;
                    fill-opacity: .8;
                    overflow-y: scroll;
                }
      #slide{
        width: 400px;
  
      }
      #slider-range{
           width: 380px;
           margin: 15px;
      }
  
      /* The Modal (background) */
  .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 3; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow-y: scroll; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  }
  
  /* Modal Content */
  .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 40%;
  }
  
  /* The Close Button */
  .close {
    color: #aaaaaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }
  
  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
  
  .round{
    width: 40%;
      border-radius: 15px;
      border: 1px #000 solid;
      padding: 5px 5px 5px 25px;
      position: absolute;
      height: 30px;
      font-size: 18px;
      
  
  }
  
  input:focus::placeholder {
    color: transparent;
  }
  
  #search{
    position: absolute;
    margin-top: 7px;
    left: 35px;
  }
  
  #button{
    position: absolute;
    margin-top: 7px;
    left: 40%;
  }
  
  #mybtn{
    margin-left: 45%;
    position: absolute;
    color: #2a5599;
  }
  
  body {font-family: Arial, Helvetica, sans-serif;}
    h4{
      color: white;
    }
  
  #reset{
    margin-left: 41%;
    position: absolute;
  }
  
        </style>
        <script src="./d3-lasso.min.js"></script>
        <script src="d3.js"></script>
        <title>COVID-19 Dashboard</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
  
    </head>
    
    <body>
        <h1>COVID-19 Dashboard</h1>
        <div id="myModal" class="modal">
    
          <!-- Modal content -->
          <div class="modal-content" style="background-color: #2a6592; color:rgb(209, 178, 178);">
            <span class="close">&times;</span>
            <p style="color: white; font-weight: 1em; font-size: 16px; letter-spacing: .3em; ">
              
              <h4>1. To select a single country.</h4> 
                --> select "Bangladesh"
              <h4>2. To select multiple countries.</h4>
              --> select "China","USA",..
              <h4>3. To choose a particular case.</h4>
                --> select/show death/recovered/confirmed cases
              <h4>4. To find minimum/maximum death/recovered/confirmed cases.</h4>
                --> find maximum/minimum death/recovered/confirmed cases
              <h4>5. To select a particular date range.</h4>
              --> from m/d/y to m/d/y
              <h4>6. To find minimum/maximum death/recovered/confirmed cases among some selected countries.</h4>
              --> first select some countries by using lasso/select command then use the find maximum command
              <h4>7. To find minimum/maximum death/recovered/confirmed cases in particular date range.</h4>
              --> first select a date range by using lasso/slider/from to command then use the find maximum command
              <h4>8. To reset or clear the window.</h4>
              --> cls/clear/clear all
            
            </p>
          </div>
        
        </div>
        <div class="result">
          
          <div>
          <input type="text" id="command"  placeholder="type 'select us,china'" class="round">
          <i class="fa fa-search" id="search" aria-hidden="true" onclick="command()" ></i>
          <i class="fa fa-microphone"  id="button" aria-hidden="true"></i>
          <!-- <input type="image" id="button" src="image.png" width="20" height="20"> -->
          <!-- <!-- <button onclick="command()">Enter</button> -->
          <i class="fa fa-question-circle fa-2x" aria-hidden="true" id="myBtn"></i>
          <i class="fa fa-refresh fa-2x" aria-hidden="true" id="reset"></i>
          <!-- <button id="myBtn">Supported Commands</button> -->
          </div>
          <!-- //akane print korbi -->
          <div class="res" id="res">Showing Results for All Countries</div> 
          <div class="res1" id="res1"></div>
  
        </div>
        <div class="info">
                <div class="tc" ></div>
               <div class="tc1"></div>
                <div class="tc2"></div> 
                <div style="border-right:1px dotted #BDBDBD; padding: 0 1em;">
                    <form >
                        <label style="color: #616771;">Choose Case:</label>
                      <select id="options" name="cars" onchange="ddl()">
                        <option value="confirmed Cases">confirmed Cases</option>
                        <option value="Death Cases">Death Cases</option>
                        <option value="Recovered Cases">Recovered Cases</option>
                        <!-- <option value="New Cases">New Cases</option> -->
                      </select>
                    </form>
                  </div>
                  <div style="border-right:1px dotted #BDBDBD; padding: 0 1em;">
                    <form >
                        <label style="color: #616771;">Select Country:</label>
                      <select id="countries" class="chosen" name="countries" onchange="myScript()">
                        
                      </select>
                    </form>
                  </div>
                  <div>
                      <label for="amount" style="color: #616771;">Date range:</label>
                      <input type="text" id="amount" style="border: 0; color: blue; font-weight: bold; background-color: #DCDCDC;" size="30"/>     
                    <div id="slider-range"></div>
                  </div>
        </div>
        <div class="mainView">
            <div id="bar">
                <svg id="BarChart"  style="transform: rotate(90deg)" >
                    
                </svg>
            </div>
            <div>
                <svg id="Map">
                    <g id="G"></g>
                </svg>
            </div>
            <div>
                <div> 
                  <svg id="container" height="450px" width="500px"> 
                    <g id="body2" style="transform: translate(60px,10px);margin-top:50px ;"></g>
                </svg>
                </div>
                <div id="tooltip"></div>
                <div style="transform: translate(190px,-250px);margin-top:50px ;"></div>
              
  
  
            </div>
            
            
    
        </div>
        
        
    
    </body>
    <script>
        let testall
        let store={}
        let slidedata;
        let uid=makeRandomId()
        store.lowercountries=[]
        store.done=[];
        store.afterlasso=[];
        store.currentcommand=null;
        store.currentselectedcountries=[];
        store.mapafterlinelasso={}
        store.scroll=false
        store.currentstartingdate=null;
        store.currentendigndate=null;
        store.currentcontinet=null;
        store.intialstart=null;
        store.intialend=null;
            let x=0
            let y=0
            let k=1
            let deg=0
            let svg=d3.select("#Map")
            let currentvis="";
            div = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0)
        
        
          function loadData() {
            return Promise.all([
            d3.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv', (d, rows, cols) => { 
          
          const dates = cols.slice(4, cols.length);
          const data = [];
            
          dates.forEach((dd, i)=> {
            const match = d['Country/Region'];
            const country = d['Country/Region'];
            const short = d['Country/Region'];
            const region = d['Province/State'];
            const iso = (match !== undefined)?match.iso:'';
            const lat = d['Lat'];
            const lon = d['Long'];
            const date = dd;
            const confirmed = +d[dd];
            const pivot = {
              country: country, short: short, region: region, lat: lat, lon: lon, date: date, confirmed: confirmed, iso: iso
            }
            
            data.push(pivot)
            
          })
          //console.log(data)
        
          return data
         
        }),
                d3.json("countries.geo.json"),
                d3.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv', (d, rows, cols) => { 
          
          const dates = cols.slice(4, cols.length);
          const data = [];
          
          dates.forEach(dd=> {
            const match = d['Country/Region']
            const country = d['Country/Region'];
            const region = d['Province/State'];
            const iso = (match !== undefined)?match.iso:'';
            const lat = d['Lat'];
            const lon = d['Long'];
            const date = dd;
            const deaths = +d[dd];
            const pivot = {
              country: country, region: region, lat: lat, lon: lon, date: date, deaths: deaths, iso: iso
            }
            
            data.push(pivot)
            
          })
          
          return data
          
        }),d3.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv', (d, rows, cols) => { 
          
          const dates = cols.slice(4, cols.length);
          const data = [];
          
          dates.forEach(dd=> {
            const match = d['Country/Region']
            const country = d['Country/Region'];
            const region = d['Province/State'];
            const iso = (match !== undefined)?match.iso:'';
            const lat = d['Lat'];
            const lon = d['Long'];
            const date = dd;
            const recovered = +d[dd];
            const pivot = {
              country: country, region: region, lat: lat, lon: lon, date: date, recovered: recovered, iso: iso
            }
            
            data.push(pivot)
            
          })
          
          return data
          
        }),
        d3.json('continent.json')
            ]).then(datasets => {
                
                store.coronadat=datasets[0];
                store.geoJSON = datasets[1];
                store.death=datasets[2];
                store.recovered=datasets[3];
                store.continent=datasets[4];
                return store;
            })
        }
        
          function showData() { 
            currentvis="confirmed";
         groupbytime()
          drawMap(prep(store.geoJSON))
          stackprocess()
          slidedata = store.sumdate;
          store.intialstart=(new Date(store.sumdate[0].date)).toLocaleDateString('en-US')
          store.intialend=(new Date(store.sumdate[store.sumdate.length-1].date)).toLocaleDateString('en-US')
          drawline(store.sumdate)
            drawCircles(store.done,"blue")
            drawbar(store.done)
           generate_country_list(store.coronadat)
     
          total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
          var stdate = slidedata[0].date, endate = slidedata[slidedata.length-1].date; // we are here
          ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet)
          groupbycontinet()
          
        
        }
        
          
            function getMapConfig(){
          let width = 620;
          let height = 450;
          let container=d3.select("#G")
          let zoom = d3.zoom()
               .scaleExtent([1, 40])
               .translateExtent([[0,0], [width, height]])
               .extent([[0, 0], [width, height]])
            .on("zoom",function(){
                zoomed(container)
            })
          
        
          let containe = d3.select("#Map")
                          .attr("height",height)
                          .attr("width",width)
                          .call(zoom)
        
          
          return {width, height, container}
        }
        
        
        function zoomed(container)
          {
            x=d3.event.transform.x
            y=d3.event.transform.y
            k=d3.event.transform.k
         
        container.attr(
              "transform","translate(" + [d3.event.transform.x, d3.event.transform.y] + ")scale(" + d3.event.transform.k + ")rotate("+deg+",300,150)")
             
          }
        
        function getMapProjection(config) {
          let {width, height} = config;
          let projection = d3.geoMercator()
          projection.scale(98)
                    .translate([width / 2, height / 2+110])
                    .rotate([0,0,0])
                    
          store.mapProjection = projection;
          return projection;
        }
        
        function drawBaseMap(container, countries, projection){
          let path =d3.geoPath()
                     .projection(projection)
        mc=0
        for(i of countries)
        {
          if(currentvis=="confirmed"){
          if(mc<i.confirmed){
              mc=i.confirmed
          }}
          else if(currentvis=="death"){
          if(mc<i.deaths){
              mc=i.deaths
          }}
          else if(currentvis=="recovered"){
          if(mc<i.recovered){
              mc=i.recovered
          }}
        }
        //console.log(mc)
        clr=[]
        if(currentvis=="confirmed"){
          clr=["white","blue"];
          }
          else if(currentvis=="death"){
            clr=["white","red"];
            }
          else if(currentvis=="recovered"){
            clr=["white","green"];
            }
        
        // var color_scale =d3.scaleLinear().domain([0,mc]).range(["white","red"]);
        var color_scale=d3.scaleLinear()
    .domain([0,100])
    .range(clr);
        
          container.selectAll("path").data(countries)
              .enter().append("path")
              .attr("d",d=>path(d) )
              .attr("fill", function(d){
                if (currentvis=="confirmed")
                {                                                              //
  
                  if (d.confirmed>mc*.9) return '#084594';
                  else if(d.confirmed>mc*.09) return '#2171b5';
                  else if(d.confirmed>mc*.01) return "#4292c6";
                  else if(d.confirmed>mc*.004) return "#6baed6";
                  else if (d.confirmed>mc*.001)return "#9ecae1";
                  else if(d.confirmed>0) return "#c6dbef";
                  else return "#f7fbff"
                }
                else if(currentvis=="death")
                {
                  if(d.deaths>mc*.5) return '#99000d';
                  else if(d.deaths>mc*.1) return '#cb181d';
                  else if(d.deaths>mc*.03)return "#ef3b2c";
                  else if(d.deaths>mc*.01)return "#fb6a4a";
                  else if(d.deaths>mc*.005)return '#fc9272';
                  else if(d.deaths>mc*.001)return "#fcbba1";
                  else if(d.deaths>0)return "#fcbba1";
                  else return "#fff5f0";            
                }
                else if(currentvis=="recovered")
                { 
                  if (d.recovered>mc*.9) return '#005a32';
                  else if(d.recovered>mc*.09) return '#238b45';
                  else if(d.recovered>mc*.01) return "#41ab5d";
                  else if(d.recovered>mc*.004) return "#74c476";
                  else if (d.recovered>mc*.001)return "#a1d99b";
                  else if(d.recovered>0) return "#c7e9c0";
                  else return "#f7fcf5"
                }
                  
              })
            .attr("stroke", "gray")
            .attr("stroke-width", .5)
            .on("mousemove", function(d) {
                 d3.select(this)
                 .attr("stroke","black")
                 .attr("stroke-width", "1px")
                 div
                .transition()
                .duration(200)
                .style("opacity", .9);
              div
                .html(
                  "<b>COUNTRY: </b>" +
                    d.properties.name +
                    "</br><b>confirmed CASES: </b>" +
                  d.confirmed +
                  "</br><b>DEATH CASES: </b>" +
                  d.deaths +
                  "</br><b>RECOVERED CASES: </b>" +
                  d.recovered 
                )
                .attr("class","tooltip1")
                .style("left", 790 + "px")
                .style("top", 235 + "px");
                 
                })
              .on("mouseleave",function(d){
  
                d3.select(this).attr("stroke","gray").attr("stroke-width",".5px").attr("fill", function(d)
                {
                  if (currentvis=="confirmed")
                {                                                              //
  
                  if (d.confirmed>mc*.9) return '#084594';
                  else if(d.confirmed>mc*.09) return '#2171b5';
                  else if(d.confirmed>mc*.01) return "#4292c6";
                  else if(d.confirmed>mc*.004) return "#6baed6";
                  else if (d.confirmed>mc*.001)return "#9ecae1";
                  else if(d.confirmed>0) return "#c6dbef";
                  else return "#f7fbff"
                }
                else if(currentvis=="death")
                {
                  if(d.deaths>mc*.5) return '#99000d';
                  else if(d.deaths>mc*.1) return '#cb181d';
                  else if(d.deaths>mc*.03)return "#ef3b2c";
                  else if(d.deaths>mc*.01)return "#fb6a4a";
                  else if(d.deaths>mc*.005)return '#fc9272';
                  else if(d.deaths>mc*.001)return "#fcbba1";
                  else if(d.deaths>0)return "#fcbba1";
                  else return "#fff5f0";
                }
                else if(currentvis=="recovered")
                { 
                  if (d.recovered>mc*.9) return '#005a32';
                  else if(d.recovered>mc*.09) return '#238b45';
                  else if(d.recovered>mc*.01) return "#41ab5d";
                  else if(d.recovered>mc*.004) return "#74c476";
                  else if (d.recovered>mc*.001)return "#a1d99b";
                  else if(d.recovered>0) return "#c7e9c0";
                  else return "#f7fcf5"
                }
                })
                div
                .attr("class","tooltip1")
                .transition()
                .duration(500)
                .style("opacity", 0);
              })
  
  
  if(currentvis!="death"){
              var w = 300, h = 50;
  
      d3.select("#s").remove()
  
      var key = d3.select("#Map")
        .append("svg")
        .attr("id","s")
        .attr("width", w)
        .attr("height", h);
  
      var legend = key.append("defs")
        .append("svg:linearGradient")
        .attr("id", "gradient")
        .attr("x1", "0%")
        .attr("y1", "100%")                             
        .attr("x2", "100%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");
  
      
  
      legend.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", function(d)
        {
          if(currentvis=="confirmed")return "#f7fbff";
          else if(currentvis=="recovered")return "#f7fcf5";
        }
        )
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "16.67%")
        .attr("stop-color", function(d)
        {
          if(currentvis=="confirmed")return "#c6dbef";
          else if(currentvis=="recovered")return "#c7e9c0";
        }
        )
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "33.34%")
        .attr("stop-color",
        function(d)
        {
          if(currentvis=="confirmed")return "#9ecae1";
          else if(currentvis=="recovered")return "#a1d99b";
        }
         )
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "50.01%")
        .attr("stop-color", function(d)
        {
          if(currentvis=="confirmed")return "#6baed6";
          else if(currentvis=="recovered")return "#74c476";
        }
        )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "66.68%")
        .attr("stop-color",function(d)
        {
          if(currentvis=="confirmed")return "#4292c6";
          else if(currentvis=="recovered")return "#41ab5d";
        }
         )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "83.35%")
        .attr("stop-color",function(d)
        {
          if(currentvis=="confirmed")return "#2171b5";
          else if(currentvis=="recovered")return '#238b45';
        }
         )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "100%")
        .attr("stop-color",
        function(d)
        {
          if(currentvis=="confirmed")return '#084594';
          else if(currentvis=="recovered")return '#005a32';
        } )
        .attr("stop-opacity", 1);
  
      key.append("rect")
        .attr("width", w)
        .attr("height", h - 30)
        .style("fill", "url(#gradient)")
        .attr("transform", "translate(20,10)");
  
      a=[]
      if(currentvis=="confirmed")a= [Math.round((mc*.9)/1000)+"k",Math.round((mc*.09)/1000)+"k",Math.round((mc*.01)/1000)+"k",Math.round((mc*.004)/1000)+"k",Math.round((mc*.001)/1000)+"k",Math.round((mc*.0009)/1000)+"k" , 0];
      else if(currentvis=="recovered")a= [Math.round((mc*.9)/1000)+"k",Math.round((mc*.09)/1000)+"k",Math.round((mc*.01)/1000)+"k",Math.round((mc*.004)),Math.round(mc*.001),Math.round((mc*.0009)) , 0]
      var y = d3.scaleBand()
        .range([300, 0])
        .domain(a
          );
  
     d3.select("#a").remove()
     d3.select("#b").remove()     
  
      d3.select("#Map").append("g")
        .attr("id","a")
        .attr("class", "y_axis")
        .attr("color","black")
        .attr("transform", "translate(15,15)")
        .append("text")
        .attr("y", 0)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text(0);
  
        d3.select("#Map").append("g")
        .attr("id","b")
        .attr("class", "y_axis")
        .attr("color","black")
        .attr("transform", "translate(305,15)")
        .append("text")
        .attr("y", 0)
        .attr("dy", ".71em")
        .text(function(d)
        {
          if (mc.toString().length >6)return (mc/1000000).toFixed(2) + "M" ;
          else if(mc.toString().length>=3) return (mc/1000).toFixed(2) +"k";
          else return mc
        });
  
  
  
  
  }
  
  else{
  
  
  
    var w = 300, h = 50;
  
      d3.select("#s").remove()
      var key = d3.select("#Map")
        .append("svg")
        .attr("id","s")
        .attr("width", w)
        .attr("height", h);
  
      var legend = key.append("defs")
        .append("svg:linearGradient")
        .attr("id", "gradient")
        .attr("x1", "0%")
        .attr("y1", "100%")                             
        .attr("x2", "100%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");
  
      legend.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", "#fff5f0")
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "16.67%")
        .attr("stop-color", "#fcbba1")
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "33.34%")
        .attr("stop-color",'#fc9272'
         )
        .attr("stop-opacity", 1);
  
      legend.append("stop")
        .attr("offset", "50.01%")
        .attr("stop-color", "#fb6a4a" )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "66.68%")
        .attr("stop-color","#ef3b2c"
         )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "83.35%")
        .attr("stop-color",'#cb181d'
         )
        .attr("stop-opacity", 1);
  
        legend.append("stop")
        .attr("offset", "100%")
        .attr("stop-color",'#99000d')
        .attr("stop-opacity", 1);
  
      key.append("rect")
        .attr("width", w)
        .attr("height", h - 30)
        .style("fill", "url(#gradient)")
        .attr("transform", "translate(20,10)");
  
        d3.select("#a").remove()
     d3.select("#b").remove()     
  
      d3.select("#Map").append("g")
        .attr("id","a")
        .attr("class", "y_axis")
        .attr("color","black")
        .attr("transform", "translate(15,15)")
        .append("text")
        .attr("y", 0)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text(0);
  
        d3.select("#Map").append("g")
        .attr("id","b")
        .attr("class", "y_axis")
        .attr("color","black")
        .attr("transform", "translate(305,15)")
        .append("text")
        .attr("y", 0)
        .attr("dy", ".71em")
        .text(function(d)
        {
          if (mc.toString().length >6)return (mc/1000000).toFixed(2) + "M" ;
          else if(mc.toString().length>=3) return (mc/1000).toFixed(2) +"k";
          else return mc
        });
  
      
  }
  
        
    l=d3.select("#G").selectAll('path')._groups[0]
    ln=d3.select("#G").selectAll('path')._groups[0].length
  
    for(let i=0;i<ln;i++)
    {
      if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
      {
        d3.select(l[i]).classed("selected",true)
      }
      else{
        d3.select(l[i]).classed("selected",false)
      }
    }
             
             
              
              
        }
        
        function drawMap(geoJeon) {
            let config = getMapConfig();
            let projection = getMapProjection(config)
            drawBaseMap(config.container, geoJeon.features, projection)
        }
        
        let myData;
        function groupbyCountry(data) {
          
            confirmedLatest = data.map(d => d[d.length-1]).sort((a,b) => b.confirmed - a.confirmed);
            myData = confirmedLatest;
            
            let result = confirmedLatest.reduce((result, d) => {
                
                
                let grpbycounty = result[d.country] || {
                    country: d.country,
                    short: d.short,
                    lat: d.lat,
                    lon: d.lon,
                    iso: d.iso,
                    date: d.date,
                    confirmed: 0
                }
                grpbycounty.confirmed += d.confirmed
                result[d.country] = grpbycounty
        
                return result
            }, {})
            result = Object.keys(result).map(key => result[key])
            result= result.sort((a,b) => b.confirmed - a.confirmed);
            
            return result;
        }
        
        function groupbyCountryDeath(data)
        {
          confirmedLatestdeath = data.map(d => d[d.length-1]).sort((a,b) => b.deaths - a.deaths);
            myData = confirmedLatestdeath;
            
            let result = confirmedLatestdeath.reduce((result, d) => {
                
                
                let grpbycounty = result[d.country] || {
                    country: d.country,
                    lat: d.lat,
                    lon: d.lon,
                    iso: d.iso,
                    date: d.date,
                    deaths: 0
                }
                grpbycounty.deaths += d.deaths
                result[d.country] = grpbycounty
        
                return result
            }, {})
            result = Object.keys(result).map(key => result[key])
            result= result.sort((a,b) => b.deaths - a.deaths);
            
            return result;
        }
        
        
        function groupbyCountryRecovered(data)
        {
          confirmedLatestrecovered = data.map(d => d[d.length-1]).sort((a,b) => b.recovered - a.recovered);
            myData = confirmedLatestrecovered;
            
            let result = confirmedLatestrecovered.reduce((result, d) => {
              
                
                let grpbycounty = result[d.country] || {
                    country: d.country,
                    lat: d.lat,
                    lon: d.lon,
                    iso: d.iso,
                    date: d.date,
                    recovered: 0
                }
                grpbycounty.recovered += d.recovered
                result[d.country] = grpbycounty
        
                return result
            }, {})
            result = Object.keys(result).map(key => result[key])
            result= result.sort((a,b) => b.recovered - a.recovered);
            
            return result;
        }
        
        //group by time start
        function groupbytime()
        {
        
          var byCountry = d3.nest()
            .key(function(d) {
              return d.country;
            })
            .entries(store.coronadat.flat());
           
        
          b=byCountry[0].values
          for(i of byCountry)
          {
            if(i.values>b){
              let a={}
              for(j of i.values)
              {
                 if (!(j.date in a))
                 {
                   a[j.date]={
                    country: j.country,
                    lat: j.lat,
                    lon: j.lon,
                    iso: j.iso,
                    date: j.date,
                    confirmed: j.confirmed
  
                   }
                
  
                 }
                 else if(j.date in a){
                  
                a[j.date].confirmed+=j.confirmed;
                 }
  
              }
              let l=[]
              for( h in a)
              {
                
                l.push(a[h])
              }
              i.values=l
            }
          }
         
  
  //////death///////
          var byCountrydeath = d3.nest()
            .key(function(d) {
              return d.country;
            })
            .entries(store.death.flat());
           
          b=byCountrydeath[0].values
          for(i of byCountrydeath)
          {
            if(i.values>b){
              let a={}
              for(j of i.values)
              {
                 if (!(j.date in a))
                 {
                   a[j.date]={
                    country: j.country,
                    lat: j.lat,
                    lon: j.lon,
                    iso: j.iso,
                    date: j.date,
                    deaths: j.deaths
  
                   }
                
  
                 }
                 else if(j.date in a){
                  
                a[j.date].deaths+=j.deaths;
                 }
  
              }
              let l=[]
              for( h in a)
              {
                
                l.push(a[h])
              }
              i.values=l
            }
          }
  
  
  /////////recovered////////
          var byCountryrecoverd = d3.nest()
            .key(function(d) {
              return d.country;
            })
            .entries(store.recovered.flat());
           
          b=byCountryrecoverd[0].values
          for(i of byCountryrecoverd)
          {
            if(i.values>b){
              let a={}
              for(j of i.values)
              {
                 if (!(j.date in a))
                 {
                   a[j.date]={
                    country: j.country,
                    lat: j.lat,
                    lon: j.lon,
                    iso: j.iso,
                    date: j.date,
                    recovered: j.recovered
  
                   }
                
  
                 }
                 else if(j.date in a){
                  
                a[j.date].recovered+=j.recovered;
                 }
  
              }
              let l=[]
              for( h in a)
              {
                
                l.push(a[h])
              }
              i.values=l
            }
          }
  
        
        for(i=0;i<byCountry.length;i++)
        {
          for(j=0;j<byCountry[i].values.length;j++)
          {
            byCountry[i].values[j].deaths=byCountrydeath[i].values[j].deaths;
            
             byCountry[i].values[j].active=byCountry[i].values[j].confirmed - byCountry[i].values[j].deaths;
            if (j==0){
            byCountry[i].values[j].new=0}
            else{
              byCountry[i].values[j].new=byCountry[i].values[j].confirmed - byCountry[i].values[j-1].confirmed;
            }
          }
        }
        for (i of byCountry)
        {
           for(j of byCountryrecoverd)
           {
             
                if(i.key==j.key)
                {
                  for( k=0;k<j.values.length;k++)
                  {
                    i.values[k].recovered=j.values[k].recovered;
                    i.values[k].active-=j.values[k].recovered;
                  }
                  break;
                }
           }
           
        }
      
           store.time=byCountry;
           store.save=byCountry;
  
        df=byCountry[0].values.length
        k=[]
        
        
        for(i=0;i<df;i++)
        {
          let c=0;
          let d=0;
          let r=0;
          dt=''
          for(j=0;j<store.time.length;j++)
          {
            dt=store.time[j].values[i].date;
            c+=store.time[j].values[i].confirmed;
            d+=store.time[j].values[i].deaths;
            r+=store.time[j].values[i].recovered;
          }
          k.push({
            date:dt,
            confirmed: c,
            deaths: d,
            recovered: r,
            new_case: 0,
            new_death: 0
          })
            store.sumdate=k
  
         
        }
  
        
        store.sumdate[0].new_case=store.sumdate[0].confirmed
        store.sumdate[0].new_death=store.sumdate[0].deaths
        for(let i=1;i<store.sumdate.length;i++)
        {
          store.sumdate[i].new_case=store.sumdate[i].confirmed - store.sumdate[i-1].confirmed
          store.sumdate[i].new_death=store.sumdate[i].deaths - store.sumdate[i-1].deaths
        }
        
          
        }
  //// end group by time
        function prep(){
            
            a=groupbyCountry(store.coronadat);
            k=groupbyCountryDeath(store.death)
            z=groupbyCountryRecovered(store.recovered)
            
            for(f of a)
            {
  
                for (g of k){
                    if(f.country==g.country)
                    {
                        f.deaths=g.deaths;
                        break;
                    }
  
                }
                for(h of z)
                {
                   if(f.country==h.country)
                   {
                       f.recovered=h.recovered;
                       break;
                   }
                }
            }
  
            for(i=0;i<a.length;i++)
            {
                
                b=a[i].country;
                // a[i].deaths=k[i].deaths;
                // a[i].recovered=z[i].recovered;
                if(b=="US"){
                    b="United States of America"
                }
                else if(b=="Tanzania")
                {
                  b="United Republic of Tanzania" 
                }
                else if(b=="Congo (Kinshasa)")
                {
                  b="Democratic Republic of the Congo"
                }
                else if(b=="Congo (Brazzaville)")
                {
                  b="Republic of the Congo"
                }
                else if(b=="Cote d'Ivoire")
                {
                  b="Ivory Coast"
                }
                else if(b=="Burma")
                {
                  b="Myanmar"
                }
                else if(b=="Korea, South")
                {
                  b="South Korea"
                }
                else if(b=="Taiwan*")
                {
                  b="Taiwan"
                }
                else if(b=="Czechia")
                {
                  b="Czech Republic"
                }
                else if(b=="Serbia")
                {
                  b="Republic of Serbia"
                }
                for (j of store.geoJSON.features)
                {
                    if(j.properties.name==b)
                    {
                        j.confirmed=a[i].confirmed;
                        j.deaths=a[i].deaths;
                        j.recovered=a[i].recovered;
                        j.country=a[i].country
                        j.date=a[i].date
                        break;
                    }
                    else {
                      if(!('country' in j))
                      {
                        j.country=""
                      }
                    }
                    
                }
            }
            for (i of store.geoJSON.features)
            {
                if(!('confirmed' in i)){
                    i.confirmed=0;
                    i.deaths=0
                    i.recovered=0
                    i.date=0
                }
            }
  
            store.done=a
            store.date=a[0].date;
            store.mapafterlinelasso=store.geoJSON
            return store.geoJSON;
            
  
  
        }
  
        function stackprocess()
        {
          if(currentvis=="confirmed")
          {
            a=store.done.sort((a,b) => b.confirmed - a.confirmed);
          }
          else if(currentvis=="death")
          {
            a=store.done.sort((a,b) => b.deaths - a.deaths);
          }
          else{
            a=store.done.sort((a,b) => b.recovered - a.recovered);
          }
          let l=[]
            for(i of a)
            {
              l.push({
                country: i.country,
                cases: "confirmed",
                number: i.confirmed
              })
              l.push({
                country: i.country,
                cases: "Active",
                number: (i.confirmed - (i.recovered + i.deaths))
              })
              l.push({
                country: i.country,
                cases: "Recovered",
                number: i.recovered
              })
              l.push({
                country: i.country,
                cases: "Death",
                number: i.deaths
              })
            }
            store.stackbar=l
            return l
        }
  
        
        
        function drawCircles(countrycircle,clr) {
          let config = getMapConfig(); 
          let projection = getMapProjection(config)
          let container = config.container; 
          container.innerHTML=""
          radius = d3.scaleSqrt([0,d3.max(countrycircle, d=> d.confirmed)], [.5, config.width/40])
          let circles = container.selectAll("circle")
            .data(countrycircle)
            .enter()               //confiremedlates earlier//
          .append("circle")
          .attr("class", "confirmed")
            .attr("fill", clr)
            .attr("fill-opacity", ".15")
            .join("circle")
            .attr("transform", d => `translate(${projection([d.lon,d.lat])[0]},${projection([d.lon,d.lat])[1]})`)
            .attr("r", 0)
              
              var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",false)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false);
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
  
                    
                    let d=[];
                    let cn=[];
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
  
        d.sort((a,b)=>b.confirmed - a.confirmed)
          if(lasso.selectedItems()._groups[0].length>0)
                      {
                        
                      scrollbar(d[0].country)
                      }
          else if(lasso.selectedItems()._groups[0].length==0){
            clearbar()
          drawbar(store.done)
          }    
          for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
          cn=cn.filter(v=> v!="");
        if(cn.length!=0) store.currentselectedcountries=cn;
        if(d.length!=0) store.afterlasso=d
        store.currentcontinet=null
        
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
        call_ShowResult();
  
         
  
        l= d3.selectAll("rect")._groups[0]
       for(i=0;i<205;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
  
       
       if(d.length>0){
        document.getElementById("countries").value="selected from other interactions";
         aftermaplasso(d);
       }
       else{


        l= d3.select("#G").selectAll("path")._groups[0]
     for(i=0;i<180;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
         d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   document.getElementById("countries").value="All";
      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
       } 
  
       $("#countries").trigger("chosen:updated");
  
       if(store.currentcommand!=null)
         {
           let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
         spreadsheet("Map Lasso")
        
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .targetArea(container)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                container.call(lasso)
                lasso.items(container.selectAll('path'))
  
  
        
        
        }
        
        
        
        function drawCirclesdeath(deathcircle,clr) {
          let config = getMapConfig(); 
          let projection = getMapProjection(config)
          let container = config.container; 
          container.innerHTML=""
          radius = d3.scaleSqrt([0,d3.max(deathcircle, d=> d.deaths)], [.5, config.width/40])
          let circles = container.selectAll("circle")
            .data(deathcircle)
            .enter()               
          .append("circle")
          .attr("class", "confirmed")
            .attr("fill", clr)
            .attr("fill-opacity", ".15")
            .join("circle")
            .attr("transform", d => `translate(${projection([d.lon,d.lat])[0]},${projection([d.lon,d.lat])[1]})`)
            .attr("r", 0)
  
        
        
        
              var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",false)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false);
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
  
                    
                        let d=[];
                    let cn=[];
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
  
        d.sort((a,b)=>b.confirmed - a.confirmed)
          if(lasso.selectedItems()._groups[0].length>0)
                      {
                        
                      scrollbar(d[0].country)
                      }
          else if(lasso.selectedItems()._groups[0].length==0){
            clearbar()
          drawbar(store.done)
          }  
          for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
          cn=cn.filter(v=> v!="");
          if(cn.length!=0) store.currentselectedcountries=cn;
        if(d.length!=0) store.afterlasso=d
        store.currentcontinet=null
        
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
        call_ShowResult();
  
         
  
        l= d3.selectAll("rect")._groups[0]
       for(i=0;i<205;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
  
       
       if(d.length>0){
        document.getElementById("countries").value="selected from other interactions";
         aftermaplasso(d);
       }
       else{


        l= d3.select("#G").selectAll("path")._groups[0]
     for(i=0;i<180;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
         d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   document.getElementById("countries").value="All";
      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
       }  
  
       $("#countries").trigger("chosen:updated");
  
       if(store.currentcommand!=null)
         {
           
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
         spreadsheet("Map Lasso")
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .items(circles)
                    .targetArea(container)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                container.call(lasso)
                lasso.items(container.selectAll('path'))
        
        
        }
        
        
        function drawCirclesRecovered(recoveredcircle,clr) {
          let config = getMapConfig(); 
          let projection = getMapProjection(config)
          let container = config.container; 
          container.innerHTML=""
          radius = d3.scaleSqrt([0,d3.max(recoveredcircle, d=> d.recovered)], [.5, config.width/40])
          let circles = container.selectAll("circle")
            .data(recoveredcircle)
            .enter()               
          .append("circle")
          .attr("class", "confirmed")
            .attr("fill", clr)
            .attr("fill-opacity", ".15")
            .join("circle")
            .attr("transform", d => `translate(${projection([d.lon,d.lat])[0]},${projection([d.lon,d.lat])[1]})`)
            .attr("r", 0)//radius funtion previosly
  
        
        
        
              var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",false)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false);
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
                    
  
                        let d=[];
                    let cn=[];
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
        d.sort((a,b)=>b.confirmed - a.confirmed)
          if(lasso.selectedItems()._groups[0].length>0)
                      {
                        
                      scrollbar(d[0].country)
                      }
          else if(lasso.selectedItems()._groups[0].length==0){
            clearbar()
            drawbar(store.done)
          }  
          for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
          cn=cn.filter(v=> v!="");
          if(cn.length!=0) store.currentselectedcountries=cn;
        if(d.length!=0) store.afterlasso=d
        store.currentcontinet=null
        
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
        call_ShowResult();
  
         
  
        l= d3.selectAll("rect")._groups[0]
       for(i=0;i<205;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
  
       
       if(d.length>0){
        document.getElementById("countries").value="selected from other interactions";
         aftermaplasso(d);
       }
       else{


        l= d3.select("#G").selectAll("path")._groups[0]
     for(i=0;i<180;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
         d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   document.getElementById("countries").value="All";
      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
       } 
  
       $("#countries").trigger("chosen:updated");
  
       if(store.currentcommand!=null)
         {
           
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
         spreadsheet("Map Lasso")
        
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .items(circles)
                    .targetArea(container)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                container.call(lasso)
                lasso.items(container.selectAll('path'))
        
        
        }
        
        
        function generate_country_list(data){
          let data1=groupbyCountry(data);
          
          
        
        let countries = [
          
        ];
        
        
        for(i of data1)
        {
          
          countries.push(i.country);
          store.lowercountries.push(i.country.toLowerCase())
        }
       countries= countries.sort()
       countries.unshift("All")
       countries.push("selected from other interactions")
        ul = document.getElementById("countries");
        
        let render_lists = function(lists){
          let li = "";
          for(index in lists){
            li += "<option>" + lists[index] + "</option>";
          }
          ul.innerHTML = li;
        }
        
  
        
        
        
        render_lists(countries);
  
        $(".chosen").chosen();
        
        }
        
        
        function myScript(){
  
            var selectBox = document.getElementById("countries");
            var selectedValue = selectBox.options[selectBox.selectedIndex].value;
           
            store.currentselectedcountries=[];
            store.currentselectedcountries.push(selectedValue.toLowerCase());
  
             if(selectedValue!="All" && selectedValue!="selected from other interactions")scrollbar(selectedValue)
             
          
           let c=selectedValue;
           
           if(c=="All"){store.currentselectedcountries=[]
            if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
       clearbar()
       drawbar(store.done)
       var dd = new Date(slidedata[0].date).getTime()
          let st=new Date(store.currentstartingdate)
          let en=new Date(store.currentendigndate)
          var s = Math.abs(st-dd)/86400000
          var e = Math.abs(en-dd)/86400000
       if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
       else drawline(slidedata.slice(s,e+1));
  
           }
           call_ShowResult();
           highlight_show_top_result_call_command(); 
           spreadsheet("Dropdown Country")
          
        }
  
        function myScript1(e){
          
          //click event apatoto off
           
       }
        
        function total_case_print(data)
        {
          let cf=0;
          let d;
          if(data.length!=0){
            if(store.currentselectedcountries.length==0){
            for(i of data)
            {
              cf+=i.confirmed;
        d=i.date;
            }
            }
            else{
              for(i of data)
            {
              if(store.currentselectedcountries.includes(i.country.toLowerCase())){
              cf+=i.confirmed;
        d=i.date;
              }
            }
  
            }
            d3.select(".tc").html(
  "<span style='font-weight:bold;font-size:1.5em;color:#2a5599'>"+addcomma(cf)+"</span>"+ 
  "</br>"+"confirmed Cases"
                  
                )
            
        }
        else{
          data=groupbyCountry(store.coronadat)
          for(i of data)
            {
              cf+=i.confirmed;
        d=i.date;
            }
            d3.select(".tc").html(
                "<span style='font-weight:bold;font-size:1.5em;color:#2a5599'>"+addcomma(cf)+"</span>"+
  "</br>"+"confirmed Cases"
                )
          
          
        }
        }
        
        function total_case_print1(data)
        {
          let cf=0;
          let d;
          if(data.length!=0){
            if(store.currentselectedcountries.length==0){
            for(i of data)
            {
              cf+=i.deaths;
        d=i.date;
            }
            }
            else{
              for(i of data)
            {
              if(store.currentselectedcountries.includes(i.country.toLowerCase())){
              cf+=i.deaths;
        d=i.date;
              }
            }
  
            }
            d3.select(".tc1").html(
                "<span style='font-weight:bold;font-size:1.5em;color:#cb181d'>"+addcomma(cf)+"</span>"+
  "</br>"+"Deaths"
                )
            
        }
        else{
          data=groupbyCountryDeath(store.death)
          for(i of data)
            {
              cf+=i.deaths;
        d=i.date;
            }
            d3.select(".tc1").html(
                "<span style='font-weight:bold;font-size:1.5em;color:#cb181d'>"+addcomma(cf)+"</span>"+
  "</br>"+"Deaths"
                )
            
          
        }
        }
        
        
        function total_case_print2(data)
        {
          let cf=0;
          let d;
          if(data.length!=0){
            if(store.currentselectedcountries.length==0){
            for(i of data)
            {
              cf+=i.recovered;
        d=i.date;
            }
            }
            else{
              for(i of data)
            {
              if(store.currentselectedcountries.includes(i.country.toLowerCase())){
              cf+=i.recovered;
        d=i.date;
              }
            }
  
            }
            d3.select(".tc2").html(
                "<span style='font-weight:bold;font-size:1.5em;color:#238b45'>"+addcomma(cf)+"</span>"+
  "</br>"+"People Recovered"
                )
            
        }
        else{
          data=groupbyCountryRecovered(store.recovered)
          for(i of data)
            {
              cf+=i.recovered;
        d=i.date;
            }
            d3.select(".tc2").html(
                "<span style='font-weight:bold;font-size:1.5em;color:#238b45'>"+addcomma(cf)+"</span>"+
  "</br>"+"People Recovered"
                )
            
          
        }
        }
        
        function ddl()
        {
          var selectBox = document.getElementById("options");
            var selectedValue = selectBox.options[selectBox.selectedIndex].value;
          
            if(selectedValue=="Death Cases"){
              currentvis="death";
            // document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
            d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.deaths - a.deaths));
            else  drawbar(store.done.sort((a,b)=>b.deaths - a.deaths));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCirclesdeath(store.done,"red")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
          
          
          
            }
            else if(selectedValue=="confirmed Cases")
        
            {
              currentvis="confirmed";
            //   document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
              d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.confirmed - a.confirmed));
            else  drawbar(store.done.sort((a,b)=>b.confirmed - a.confirmed));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCircles(store.done,"blue")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
          //d3.select(".res").text("Showing Results of confirmed Cases for All Countries");
            }
            else if(selectedValue=="Recovered Cases")
            {
              currentvis="recovered";
            //   document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
              d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.recovered - a.recovered));
            else  drawbar(store.done.sort((a,b)=>b.recovered - a.recovered));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCirclesRecovered(store.done,"red")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
         // d3.select(".res").text("Showing Results of Recovered Cases for All Countries");
            }
  
            if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
  
    
          if(store.currentselectedcountries.length!=0)drawline(commandline(store.currentselectedcountries));
          call_ShowResult();
          let l=d3.select("#BarChart").selectAll("rect")._groups[0]
          let ln=d3.select("#BarChart").selectAll("rect")._groups[0].length-2
          let cn=''
          
          for(let i=0;i<ln;i++)
          {
            if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
            {
              cn=l[i].__data__.country.toLowerCase()
              break
            }
          }
          if(store.currentselectedcountries.length>0)scrollbar(cn)
          // if(store.currentselectedcountries.length!=0 && document.getElementById("countries").value=="selected from other interactions")document.getElementById("countries").value="selected from other interactions"
  
          // $("#countries").trigger("chosen:updated");
          //kisu kaj korte hobe akane
          if(store.currentcommand!=null)
         {
           
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
         spreadsheet("Dropdown Cases")
            
        }
  
  let lassobar;
        function drawbar(data){
     //console.log(data)
      lassobar = data;
               
  var margin =  {top: 10, right: 0, bottom: 70, left: 55};
  var marginOverview = {top: 10, right: 0, bottom: 70, left: 55};
  var selectorHeight = 15;
  var width = 450 - margin.left - margin.right;
  var height = 380 - margin.top - margin.bottom - selectorHeight;
  var heightOverview = 80 - marginOverview.top - marginOverview.bottom;
       
  var maxLength = d3.max(data.map(function(d){ return d.country.length}))
  var barWidth = 20;
  var numBars = Math.round(width/barWidth);
  var isScrollDisplayed = barWidth * data.length > width;
       
  
  // console.log(isScrollDisplayed)
  
  var xscale = d3.scaleBand()
                .domain(data.slice(0,numBars).map(function (d) { return d.country; }))
                .range([0, width])
                .padding(.2);
  
  var yscale = d3.scaleLinear()
              .domain([0, d3.max(data, function (d) { 
                                if(currentvis=="confirmed")
                                {
                                    return d.confirmed;
                                }
                                else if(currentvis=="death")
                                {
                                    return d.deaths;
                                }
                                else{
                                    return d.recovered;
                                }
                                 })])
              .range([height, 0]);
  
  var xAxis  = d3.axisBottom(xscale);
  var yAxis  = d3.axisLeft(yscale).tickFormat(d3.format(".02s"));
  
  var svg = d3.select("#BarChart")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom + selectorHeight);
  
  var diagram = svg.append("g")
                 .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  
  diagram.append("g")
       .attr("class", "x axis")
       .attr("transform", "translate(0, " + height + ")")
       .call(xAxis)
       .selectAll("text")	
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.5em")
            .attr("transform", function(d) {
                return "rotate(-90)" 
                });
  diagram.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", -58)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Total Case"); 
  
  diagram.append("g")
       .attr("class", "y axis")
       .call(yAxis)
       .selectAll("text")	
            .style("text-anchor", "end")
            .style("font-size","12px")
  var bars = diagram.append("g");
  
  bars.selectAll("rect")
            .data(data.slice(0, numBars), function (d) {return d.country; })
            .enter()
            .append("rect")
            .attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d';
              else if(currentvis=="recovered") return '#238b45';
            })                                        
            .attr("x", function (d) { return xscale(d.country); })
            .attr("y", function (d) { 
                                if(currentvis=="confirmed")
                                {
                                    return yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return yscale(d.deaths);
                                }
                                else{
                                    return yscale(d.recovered);
                                }
                 })
            .attr("width", xscale.bandwidth())
            .attr("height", function (d) { 
                                if(currentvis=="confirmed")
                                {
                                    return height - yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return height - yscale(d.deaths);
                                }
                                else{
                                    return height - yscale(d.recovered);
                                }
                 })
                 .on("mouseenter", function(d) {
                  d3.select(this).attr("fill", "#992a5b")
                  
                 
                 
                })
                .on("mousemove",function(d){
                  div
                .transition()
                .duration(200)
                .style("opacity", .9);
              div
              .html(
                  "<b>COUNTRY: </b>" +
                    d.country +
                    "</br><b>confirmed CASES: </b>" +
                  d.confirmed +
                  "</br><b>Death CASES: </b>" +
                  d.deaths +
                  "</br><b>Recovered CASES: </b>" +
                  d.recovered 
                )
                .attr("class","tooltip")
                .style("left", d3.event.clientX + "px")
                .style("top", d3.event.clientY - 28 + "px");
                })
              .on("mouseleave",function(){
                d3.select(this).attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d';//'#005a32''#99000d'  '#cb181d''#238b45'
              else if(currentvis=="recovered") return '#238b45';
            })   
                div
                .attr("class","tooltip")
                .transition()
                .duration(500)
                .style("opacity", 0);
              })
            .on("click", d=>{
        //         //console.log(d.country);
        //          myScript1(d.country);
        //        // drawline(d.country, store.coronadat)
  
        //        for ( s of store.time){
        //    if( s.key == d.country){ linedata = s; break}
        //  }
        // // console.log(linedata.values)
        // slidedata = linedata.values;
        //  drawline(linedata.values)
        //click event apatoto off
         
        });
  
        let l= d3.selectAll("rect")._groups[0]
        let ln=d3.selectAll("rect")._groups[0].length-6
        
       for(i=0;i<ln;i++)
       {
         
        
        
         if(store.currentselectedcountries.includes(l[i].__data__.country) || store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
           
          
           d3.select(l[i]).classed("selected",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected",false)
         }
       }
  
       for(i=0;i<ln;i++)
       {
        
        
         if(store.currenthighlight.toLowerCase()==l[i].__data__.country.toLowerCase())
         {
           
          
           d3.select(l[i]).classed("selected1",true)
          break;
  
         }
        //  else{
        //    d3.select(l[i]).classed("selected1",false)
        //  }
       }
  
      var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",false)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false)
                        
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
                    
                    let d=[];
                    let cn=[]
                    
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
  
        for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
        if(cn.length!=0)store.currentselectedcountries=cn;
        if(d.length!=0)store.afterlasso=d
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
  
        
        store.currentcontinet=null
  
        call_ShowResult();
        
       l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
           d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
       
  
       if(d.length>0){afterbarlasso(lasso.selectedItems()._groups[0]);
        document.getElementById("countries").value="selected from other interactions";}
       else {

       l= d3.selectAll("rect")._groups[0]
     for(i=0;i<205;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
        }
  
         $("#countries").trigger("chosen:updated");
       if(store.currentcommand!=null)
         {
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }

         spreadsheet("Bar Lasso")
  
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .targetArea(svg)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                svg.call(lasso)
                lasso.items(svg.selectAll('rect'))
  
            
  
  if (isScrollDisplayed)
  {
  var xOverview = d3.scaleBand()
                  .domain(data.map(function (d) { return d.country; }))
                  .range([0, width])
                  .padding(.2);
  yOverview = d3.scaleLinear().range([heightOverview, 0]);
  yOverview.domain(yscale.domain());
  
  var subBars = diagram.selectAll('.subBar')
      .data(data)
  
  subBars.enter().append("rect")
      .classed('subBar', true)
      .attr({
          height: function(d) {
                               if(currentvis=="confirmed")
                                {
                                    return heightOverview - yOverview(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return heightOverview - yOverview(d.deaths);
                                }
                                else{
                                    return heightOverview - yOverview(d.recovered);
                                }
  
              
          },
          width: function(d) {
              return xOverview.bandwidth()
          },
          x: function(d) {
  
              return xOverview(d.country);
          },
          y: function(d) {
              
                                if(currentvis=="confirmed")
                                {
                                    return height + heightOverview + yOverview(d.confirmed)
                                }
                                else if(currentvis=="death")
                                {
                                    return height + heightOverview + yOverview(d.deaths)
                                }
                                else{
                                    return height + heightOverview + yOverview(d.recovered)
                                }
  
              
          }
      })
  
  var displayed = d3.scaleQuantize()
              .domain([0, width])
              .range(d3.range(data.length));
  
  diagram.append("rect")
              .attr("transform", "translate(0, " + (height + margin.bottom) + ")")
              .attr("class", "mover")
              .attr("x", 0)
              .attr("y", 0)
              .attr("height", selectorHeight)
              .attr("width", Math.round(parseFloat(numBars * width)/data.length))
              .attr("pointer-events", "all")
              .attr("cursor", "all-scroll")
              .call(d3.drag().on("drag", display));
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  if(store.scroll){
  
    
    
              var x = parseInt(d3.select('.mover').attr("x")),
        nx = x+store.position,
        w = parseInt(d3.select('.mover').attr("width")),
        f, nf, new_data, rects;
      
    if ( nx < 0 || nx + w > width ) return;
  
    d3.select('.mover').transition().duration(1000).attr("x", nx)
  
    f = displayed(x);
    nf = displayed(nx);
  
    if ( f === nf ) return;
  
    new_data = data.slice(nf, nf + numBars);
  
    xscale.domain(new_data.map(function (d) { return d.country; }));
    diagram.select(".x.axis").call(xAxis).selectAll("text")	
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.5em")
            .attr("transform", function(d) {
                return "rotate(-90)" 
                });
  
    rects = bars.selectAll("rect")
      .data(new_data, function (d) {return d.country; });
  
    rects.attr("x", function (d) { return xscale(d.country); });
  
    rects.enter().append("rect")
    .attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d'; 
              else if(currentvis=="recovered") return '#238b45';
            })   
      .attr("x", function (d) { return xscale(d.country); })
      .attr("y", function (d) { if(currentvis=="confirmed")
                                {
                                    return yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return yscale(d.deaths);
                                }
                                else{
                                    return yscale(d.recovered);
                                } })
      .attr("width", xscale.bandwidth())
      .attr("height", function (d) {
                                 if(currentvis=="confirmed")
                                {
                                    return height - yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return height - yscale(d.deaths);
                                }
                                else{
                                    return height - yscale(d.recovered);
                                }
            }).on("mouseenter", function(d) {
                  d3.select(this).attr("fill", "#992a5b")
                  
                 
                 
                })
                .on("mousemove",function(d){
                  div
                .transition()
                .duration(200)
                .style("opacity", .9);
              div
              .html(
                  "<b>COUNTRY: </b>" +
                    d.country +
                    "</br><b>confirmed CASES: </b>" +
                  d.confirmed +
                  "</br><b>Death CASES: </b>" +
                  d.deaths +
                  "</br><b>Recovered CASES: </b>" +
                  d.recovered 
                )
                .attr("class","tooltip")
                .style("left", d3.event.clientX + "px")
                .style("top", d3.event.clientY - 28 + "px");
                })
              .on("mouseleave",function(){
                d3.select(this).attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d';//'#005a32''#99000d'  '#cb181d''#238b45'
              else if(currentvis=="recovered") return '#238b45';
            })   
                div
                .attr("class","tooltip")
                .transition()
                .duration(500)
                .style("opacity", 0);
              })
            .on("click", d=>{
        //         //console.log(d.country);
        //          myScript1(d.country);
        //          for ( s of store.time){
        //    if( s.key == d.country){ linedata = s; break}
        //  }
        // // console.log(linedata.values)
        // slidedata = linedata.values;
        //  drawline(linedata.values)
        //        // drawline(d.country, store.coronadat)
        //apatoto click event off
        });
  
  
  
        
  
        var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",true)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false)
                        
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
                    
                    let d=[];
                    let cn=[]
                    
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
        for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
        if(cn.length!=0)store.currentselectedcountries=cn;
        if(d.length!=0)store.afterlasso=d
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
  
        
        store.currentcontinet=null
  
        call_ShowResult();
        
       l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
           d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
       
  
       if(d.length>0){afterbarlasso(lasso.selectedItems()._groups[0]);
        document.getElementById("countries").value="selected from other interactions";}
       else {

       l= d3.selectAll("rect")._groups[0]
     for(i=0;i<205;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
        }
  
         $("#countries").trigger("chosen:updated");
       if(store.currentcommand!=null)
         {
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }

         spreadsheet("Bar Lasso")
  
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .targetArea(svg)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                svg.call(lasso)
                lasso.items(svg.selectAll('rect'))
  
  
  
  
      
  
        let l= d3.selectAll("rect")._groups[0]
        let ln=d3.selectAll("rect")._groups[0].length-6
        
       for(i=0;i<ln;i++)
       {
         
        
        
         if(store.currentselectedcountries.includes(l[i].__data__.country) || store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
           
          
           d3.select(l[i]).classed("selected",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected",false)
         }
       }
  
       for(i=0;i<ln;i++)
       {
        
        
         if(store.currenthighlight.toLowerCase()==l[i].__data__.country.toLowerCase())
         {
           
          
           d3.select(l[i]).classed("selected1",true)
          break;
  
         }
        //  else{
        //    d3.select(l[i]).classed("selected1",false)
        //  }
       }
        
  
    rects.exit().remove();}
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  }
  function  display () {
    var x = parseInt(d3.select('.mover').attr("x")),
        nx = x + d3.event.dx,
        w = parseInt(d3.select('.mover').attr("width")),
        f, nf, new_data, rects;
      
    if ( nx < 0 || nx + w > width ) return;
  
    d3.select(this).attr("x", nx);
  
    f = displayed(x);
    nf = displayed(nx);
  
    if ( f === nf ) return;
  
    new_data = data.slice(nf, nf + numBars);
  
    xscale.domain(new_data.map(function (d) { return d.country; }));
    diagram.select(".x.axis").call(xAxis).selectAll("text")	
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", "-.5em")
            .attr("transform", function(d) {
                return "rotate(-90)" 
                });
  
    rects = bars.selectAll("rect")
      .data(new_data, function (d) {return d.country; });
  
    rects.attr("x", function (d) { return xscale(d.country); });
  
    rects.enter().append("rect")
    .attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d'; 
              else if(currentvis=="recovered") return '#238b45';
            })   
      .attr("x", function (d) { return xscale(d.country); })
      .attr("y", function (d) { if(currentvis=="confirmed")
                                {
                                    return yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return yscale(d.deaths);
                                }
                                else{
                                    return yscale(d.recovered);
                                } })
      .attr("width", xscale.bandwidth())
      .attr("height", function (d) {
                                 if(currentvis=="confirmed")
                                {
                                    return height - yscale(d.confirmed);
                                }
                                else if(currentvis=="death")
                                {
                                    return height - yscale(d.deaths);
                                }
                                else{
                                    return height - yscale(d.recovered);
                                }
            }).on("mouseenter", function(d) {
                  d3.select(this).attr("fill", "#992a5b")
                  
                 
                 
                })
                .on("mousemove",function(d){
                  div
                .transition()
                .duration(200)
                .style("opacity", .9);
              div
              .html(
                  "<b>COUNTRY: </b>" +
                    d.country +
                    "</br><b>confirmed CASES: </b>" +
                  d.confirmed +
                  "</br><b>Death CASES: </b>" +
                  d.deaths +
                  "</br><b>Recovered CASES: </b>" +
                  d.recovered 
                )
                .attr("class","tooltip")
                .style("left", d3.event.clientX + "px")
                .style("top", d3.event.clientY - 28 + "px");
                })
              .on("mouseleave",function(){
                d3.select(this).attr("fill", function(d)
            {
              if(currentvis=="confirmed")return "#2a5599";
              else if(currentvis=="death")return '#cb181d';//'#005a32''#99000d'  '#cb181d''#238b45'
              else if(currentvis=="recovered") return '#238b45';
            })   
                div
                .attr("class","tooltip")
                .transition()
                .duration(500)
                .style("opacity", 0);
              })
            .on("click", d=>{
        //         //console.log(d.country);
        //          myScript1(d.country);
        //          for ( s of store.time){
        //    if( s.key == d.country){ linedata = s; break}
        //  }
        // // console.log(linedata.values)
        // slidedata = linedata.values;
        //  drawline(linedata.values)
        //        // drawline(d.country, store.coronadat)
        //apatoto click event off
        });
  
  
  
  
  
        var lasso_start = function() {
                    lasso.items() // reset size
                        .classed("not_possible",true)
                        .classed("selected",false)
                        .classed("selected1",false);
                };
        
                var lasso_draw = function() {
                
                    // Style the possible dots
                    lasso.possibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
            
                    // Style the not possible dot
                    lasso.notPossibleItems()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("selected1",false);
                };
        
                var lasso_end = function() {
                    // Reset the color of all dots
                    lasso.items()
                        .classed("not_possible",false)
                        .classed("possible",false)
                        .classed("isselected",false)
                        
        
                    // Style the selected dots
                    lasso.selectedItems()
                        .classed("selected",true);
                    
                    let d=[];
                    let cn=[]
                    
                    for(i of lasso.selectedItems()._groups[0]){
                if(i.__data__!=null)
                {
                  d.push(i.__data__)
                  cn.push(i.__data__.country)
                }
        }
        for(let i=0;i<cn.length;i++)cn[i]=cn[i].toLowerCase();
        if(cn.length!=0)store.currentselectedcountries=cn;
        if(d.length!=0)store.afterlasso=d
        total_case_print(store.afterlasso)
        total_case_print1(store.afterlasso)
        total_case_print2(store.afterlasso)
  
  
        
        store.currentcontinet=null
  
        call_ShowResult();
        
       l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",true)
         }
         else{
           d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
         }
       }
       
  
       if(d.length>0){afterbarlasso(lasso.selectedItems()._groups[0]);
        document.getElementById("countries").value="selected from other interactions";}
       else {

       l= d3.selectAll("rect")._groups[0]
     for(i=0;i<205;i++)
     {
       if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
       {
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",true)
       }
       else{
        d3.select(l[i]).classed("selected1",false)
         d3.select(l[i]).classed("selected",false)
       }
     }

      //   var dd = new Date(slidedata[0].date).getTime()
      //  let st=new Date(store.currentstartingdate)
      //     let en=new Date(store.currentendigndate)
      //     var s = Math.abs(st-dd)/86400000
      //     var e = Math.abs(en-dd)/86400000
      //  if(store.currentstartingdate==null && store.currentendigndate==null)drawline(store.sumdate);
      //  else drawline(slidedata.slice(s,e+1));
        }
  
         $("#countries").trigger("chosen:updated");
  
       if(store.currentcommand!=null)
         {
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
         spreadsheet("Bar Lasso")
  
                };
                
                var lasso = d3.lasso()
                    .closePathSelect(true)
                    .closePathDistance(100)
                    .targetArea(svg)
                    .on("start",lasso_start)
                    .on("draw",lasso_draw)
                    .on("end",lasso_end);
        
                svg.call(lasso)
                lasso.items(svg.selectAll('rect'))
  
  
  
  
  
  
        let l= d3.selectAll("rect")._groups[0]
        let ln=d3.selectAll("rect")._groups[0].length-6
       for(i=0;i<ln;i++)
       {
        
        
         if(store.currentselectedcountries.includes(l[i].__data__.country) || store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
           
          console.log('rong hocce')
           d3.select(l[i]).classed("selected",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected",false)
         }
       }
       for(i=0;i<ln;i++)
       {
        
        
         if(store.currenthighlight.toLowerCase()==l[i].__data__.country.toLowerCase())
         {
           
          
           d3.select(l[i]).classed("selected1",true)
          break;
  
         }
        //  else{
        //    d3.select(l[i]).classed("selected1",false)
        //  }
       }
        
  
    rects.exit().remove();
  };
  
  
  }
  
  ////Bar end
  
  
  
  
  function drawline(data){
  
  // draw line here
  
  let body = d3.select("#body2")
  document.getElementById("body2").innerHTML="";
  let height = 400;
  let width = 430;
  data.map(d=> {
   d.date= new Date(d.date)
   d.confirmed = +d.confirmed
  })
  let max = d3.max(data,d=>d.confirmed)
  let yscale = d3.scaleLinear()
  .domain([0,max])
  .range([height,0])
  body.append("g")
  .call(d3.axisLeft(yscale)
          .ticks(15)
          .tickFormat(d3.format(".02s")));
  
          body.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", -55)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Cumulative Cases"); 
  
  
  let xscale = d3.scaleTime()
  .domain(d3.extent(data,d=>d.date))
  .range([0,width])
  body.append("g")
  .attr("transform", "translate(0,"+height+")")
  .call(d3.axisBottom(xscale)
  .tickFormat(d3.timeFormat("%d %b")))
  .selectAll("text")  
              .style("text-anchor", "end")
              .attr("dx", "-.8em")
              .attr("dy", ".15em")
              .attr("transform", "rotate(-65)" );
  
  var valueline = d3.line()
  .x(d => xscale(d.date))
  .y(d => yscale(d.confirmed))
  .defined(d => !!d.confirmed)
  
  //for tooltip
  
            
  body.append('rect')
      .style("fill", "none")
      .style("pointer-events", "all")
      .attr('width', width)
      .attr('height', height)
      // .on('mousemove', mousemove);
  
  //tool tip
  body
  .append("path")
  .datum(data)
  .attr("fill", "none")
  .attr("stroke", "#2a5599")
  .attr("stroke-width", 3)
  .attr("d", valueline)
  .attr("class", "line")
  .classed("selectedL",function (d) {  
    if(currentvis == "confirmed"){ return false;}
    else{ return true; }
    
  
    })//here we
  // .on("mouseenter", d=>{
              
  //       showtool(1,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  // .on("mouseleave", d=>{
  //       d3.select("#tooltip").style('display', 'none')
  //     })
  //   .on("mousemove", d=>{
  //       showtool(1,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  
  //draw line end 
  
  /// for tooltip
  
  var bisect = d3.bisector(function(d) { return d.date; }).left;
  
  
  function showtool(check, coord,a){
   var val
   var cas
   if(check == "confirmed"){
      val = a.confirmed
      cas = "Confirmed: "
   }
   else if(check=="recovered"){
      val = a.recovered
      cas = "Recovered: "
  
   }
   else{
      val = a.deaths
      cas = "Deaths: "
   }
    var formatDate = d3.timeFormat("%d-%b-%y")
  
    
  
          d3.select("#tooltip")
              .html("<b>"+cas+"</b>"+val+"<br> <b>Date:</b> "+ formatDate(a.date))
              .style('top', coord[1]+150+"px")
              .style("left", coord[0]+850+"px")
              .style("display", "block")
              .style("color", "black")
              .attr("class", "tooltip")
              .transition()
                .duration(500)
              
      }
       
  //end tooltip
  
  //recovered case
  var valuerc = d3.line()
  .x(d => xscale(d.date))
  .y(d => yscale(d.recovered))
  .defined(d => !!d.recovered)
  
  body
  .append("path")
  .datum(data)
  .attr("fill", "none")
  .attr("stroke", '#238b45') 
  .attr("stroke-width", 3)
  .attr("d", valuerc)
  .attr("class", "line")
  .classed("selectedL",function (d) { 
    if(currentvis == "recovered"){ return false;}
    else{ return true; }
    
  
    })
  // .on("mouseenter", d=>{
              
  //       showtool(2,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  // .on("mouseleave", d=>{
  //       d3.select("#tooltip").style('display', 'none')
  //     })
  //   .on("mousemove", d=>{
  //       showtool(2,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  // end recov
  
  //draw deaths
  var valuedth = d3.line()
  .x(d => xscale(d.date))
  .y(d => yscale(d.deaths))
  .defined(d => !!d.deaths)
  
  body
  .append("path")
  .datum(data)
  .attr("fill", "none")
  .attr("stroke", '#cb181d')
  .attr("stroke-width", 3)
  .attr("d", valuedth)
  .attr("class", "line")
  .classed("selectedL",function (d) {
    if(currentvis == "death"){ return false;}
    else{ return true; }
    
  
    })
  // .on("mouseenter", d=>{
              
  //       showtool(3,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  // .on("mouseleave", d=>{
  //       d3.select("#tooltip").style('display', 'none')
  //     })
  //   .on("mousemove", d=>{
  //       showtool(3,[d3.event.clientX -180, d3.event.clientY-30])
  //     })
  //end deaths
  // legend
  var columnHeaders = ["Deaths", "Recovered", "confirmed"];
  var color = d3.scaleOrdinal().range(
    ["#2a5599" ,'#238b45','#cb181d']);
  
    var legend = body.selectAll(".legend")
      .data(columnHeaders.slice().reverse())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
  
  legend.append("rect")
      .attr("x", 105)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);
  
  legend.append("text")
      .attr("x", 90)
      .attr("y", 5)
      .attr("dy", ".35em")
      .style("fill", color)
      .style("text-anchor", "end")
      .text(function(d) { return d; });
  
  //
  
  
  //console.log(data)
  
  
  
  body.append('g')
      .selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", function (d) { return xscale(d.date); } )
        .attr("cy", function (d) { return yscale(d.confirmed); } )
        .attr("case", "confirmed")
        .attr("r", 3)
        .attr("opacity", .1)
        .style("fill", "#2a5599")//#69b3a2   
        .on("mouseover", handleMouseOver)
        .on("mouseout", handleMouseOut);
        body.append('g')
      .selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", function (d) { return xscale(d.date); } )
        .attr("cy", function (d) { return yscale(d.recovered); } )
        .attr("case", "recovered")
        .attr("r", 3)
        .attr("opacity", .1)
        .style("fill", "#238b45")//#69b3a2
        .on("mouseover", handleMouseOver)
        .on("mouseout", handleMouseOut);
        body.append('g')
      .selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", function (d) { return xscale(d.date); } )
        .attr("cy", function (d) { return yscale(d.deaths); } )
        .attr("case", "death")
        .attr("r", 3)
        .attr("opacity", .1)
        .style("fill", "#cb181d")//#69b3a2
        .on("mouseover", handleMouseOver)
        .on("mouseout", handleMouseOut); 
  //circle hover
  function handleMouseOver(d, i) {  // Add interactivity
  
  // Use D3 to select element, change color and size
  d3.select(this)
    .attr("r", 6)
    .attr("opacity", 1)
    .attr("stroke","white")
    .attr("stroke-width", 3);
    showtool(this.getAttribute("case"),[this.cx.baseVal.value,this.cy.baseVal.value],this.__data__)
  
  }
  
  function handleMouseOut(d, i) {
  // Use D3 to select element, change color back to normal
  if( this.className.animVal != "selected"){
    d3.select(this)
    .attr("r", 3)
    .attr("opacity", .3)
    .attr("stroke", "none");
  }
  else{
    d3.select(this)
    .attr("r", 3)
    .attr("stroke", "none");
  }
  
  d3.select("#tooltip").style('display', 'none')
  
    
  
  }
  
  //end circle hover   
  
  lasso(yscale(1), data, xscale)
  
  
  }
  let ifdata = 0;
   
        loadData().then(showData);
    
  //lasso here
  let a;
  function lasso(scal, data, xscale){
    let body = d3.select("#container")
    var circles = body.selectAll("circle")
    // Lasso functions
          var lasso_start = function() {
              lasso.items()
                  .attr("r",3) // reset size
                  .attr("opacity",.3)
                  .classed("not_possible",true)
                  .classed("selected",false);
          };
  
          var lasso_draw = function() {
          
              
              lasso.possibleItems()
                  .classed("not_possible",false)
                  .classed("possible",true);
                  
                 
                  
                
                 
                  //console.log("I am from lasso data")
  
                  
              
              lasso.notPossibleItems()
                  .classed("not_possible",true)
                  .classed("possible",false);
          };
          var lasso_end = function() {
              // Reset the color of all dots
              lasso.items()
                  .classed("not_possible",false)
                  .classed("possible",false);
                  let fcircle = lasso.selectedItems()
                  let newcir = lasso.selectedItems()._groups[0].filter(function(d){ return d.getAttribute("case") == currentvis})
                  fcircle._groups[0] = newcir;
              // Style the selected dots
              fcircle
                  .classed("selected",true)
                  .attr("r",3)
                  .attr("opacity",1)
                  console.log(fcircle)
                  // .style("fill", "yellow");
                  var lassod = fcircle._groups[0]
                  var bisect = d3.bisector(function(d) { return d.date; }).left;
                  let a = lassod;
                  if(a.length){
                  var x1 =xscale.invert(a[0].cx.baseVal.value);
                  var x2 =xscale.invert(a[a.length-1].cx.baseVal.value);
                  ifdata = 1;
                  afterlasso(x1,x2)
                  var formatDate = d3.timeFormat("%d/%b/%y")
                  d3.select(".res").text("Showing Results from "+formatDate(x1)+" to "+formatDate(x2));
                  
                  }
                  if(!a.length){
                    // clearmap()
                    // drawMap(prep(store.geoJSON))
                    // clearbar()
                    if(store.currentstartingdate!=null && store.currentendigndate!=null){
                    x1 =new Date(store.currentstartingdate)
                  x2 = new Date(store.currentendigndate)}
                  else {
                    x1=slidedata[0].date;
                    x2=slidedata[slidedata.length-1].date;
                  }

                  let lne=d3.select("#container").selectAll("circle")._groups[0]
                  let ln=d3.select("#container").selectAll("circle")._groups[0].length
                  
              if(store.currentstartingdate!=null && store.currentendigndate!=null && store.intialstart!=(new Date(store.currentstartingdate)).toLocaleDateString('en-US') && store.intialend!=(new Date(store.currentendigndate)).toLocaleDateString('en-US')){
             
                  for(i of lne)
                  {
                    if(i.getAttribute("case") == currentvis && i.__data__.date>=x1-1 && i.__data__.date<=x2)
                    {
                      // console.log(i)

                      d3.select(i)
                  .classed("selected",true)
                  .attr("r",3)
                  
       
                  

                  // i.getAttribute("opacity")=1

                      
                    }

                  }
              }
            //         total_case_print(store.done);
            // total_case_print1(store.done);
            // total_case_print2(store.done);
                    
            //         d3.select(".res").text("Showing Results for All Countries");
            //         if(currentvis=="confirmed")drawbar(store.done.sort((a,b)=>b.confirmed - a.confirmed));
            //         else if(currentvis=="death")drawbar(store.done.sort((a,b)=>b.deaths - a.deaths));
            //         else if(currentvis=="recovered")drawbar(store.done.sort((a,b)=>b.recovered - a.recovered));
            //         if(currentvis=="confirmed")drawCircles(store.done,"blue");
            //         else if(currentvis=="death")drawCirclesdeath(store.done,"red")
            //         else if(currentvis=="recovered")drawCirclesRecovered(store.done,"red")
  
                  }
              // Reset the style of the not selected dots
              lasso.notSelectedItems()
                  .attr("r",3)
                  .attr("opacity",.3);
  
            //console.log(lasso.selectedItems());
            store.currentstartingdate=x1
            store.currentendigndate=x2
            ResultShow(store.currentselectedcountries,currentvis,x1,x2,store.currentcontinet);
            slideraftervoice(x1,x2)
            if(store.currentcommand!=null)
            {
              
              let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
            }
            spreadsheet("Line Lasso")
            
  
  
          };
          
          var lasso = d3.lasso()
              .closePathSelect(true)
              .closePathDistance(100)
              .items(circles)
              .targetArea(body)
              .on("start",lasso_start)
              .on("draw",lasso_draw)
              .on("end",lasso_end);
          
          body.call(lasso);
  }
  setTimeout(slide,2000)
   //end lasso
   function slide(){
     var len = slidedata.length
    /*var d1 = new Date(data[2].date)
    var d2 = new Date(data[0].date)
    Math.abs(d1-d2)/86400000*/
    //console.log(slidedata[len-1].date)x1 = slidedata[0].date
                  
  
     
    $(function() {
      $( "#slider-range" ).slider({
        range: true,
        min: new Date(slidedata[0].date).getTime() / 1000,
        max: new Date(slidedata[len-1].date).getTime() / 1000,
        step: 86400,
        values: [ new Date(slidedata[0].date).getTime() / 1000, new Date(slidedata[len-1].date).getTime() / 1000 ],
        slide: function( event, ui ) { //console.log((new Date(ui.values[ 0 ] *1000) ))
          var d1 = new Date(ui.values[ 0 ] *1000)
          var d2 = new Date(ui.values[ 1 ] *1000)
          var d3 = new Date(slidedata[0].date).getTime()
          var str = Math.abs(d1-d3)/86400000
          var end = Math.abs(d2-d3)/86400000
          stdate = d1
          endate = d2
          store.currentstartingdate=stdate
          store.currentendigndate=endate
          afterlasso(d1, d2)
          
          if(store.currentselectedcountries.length!=0)
          {
            //akane kaj kor//
            ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet);
            sliderafterbarlasso(str,end,store.time)
          }
          else{ 
            ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet);
            drawline(slidedata.slice(str,end+1))}
          if(store.currentcommand!=null){
            let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
          }
          spreadsheet("Date Range Slider")
          
          $( "#amount" ).val( (new Date(ui.values[ 0 ] *1000).toDateString() ) + " - " + (new Date(ui.values[ 1 ] *1000)).toDateString() );
        }
      });
      $( "#amount" ).val( (new Date($( "#slider-range" ).slider( "values", 0 )*1000).toDateString()) +
        " - " + (new Date($( "#slider-range" ).slider( "values", 1 )*1000)).toDateString());
        
    });
   }
  
   
  
   function sliderafterbarlasso(str,end,dn)
   {
        end++;
    // var d3 = new Date(slidedata[0].date).getTime()
    //       var str = Math.abs(d1-d3)/86400000
    //       var end = Math.abs(d2-d3)/86400000
         dh= dn
         let dim=[]
  
         
  
         for(let i=0;i<dh.length;i++)
         {
           dim.push({ key : dh[i].key,
            values:  dh[i].values.slice(str,end)}
                  )       }
     data=store.currentselectedcountries
        var pdata = []
        var finald = []
        let i = 0;
        for(x of data ){
          for (d of dim){
            
                if(x.toLowerCase() == d.key.toLowerCase()){
                  pdata[i] = d.values;
                  break;
                }
           }
        
           ++i;
      }
      i=0;
        //console.log(pdata)
        for( x of pdata[0]){
          finald[i] = {
              "confirmed" : x.confirmed,
              "recovered" : x.recovered,
              "deaths" : x.deaths,
              "date" :   x.date 
          }
          ++i;
        }
  
        for( var k =1; k< pdata.length; ++k){
          
          let j=0;
          if(pdata[k]!=null){
          for( x of pdata[k]){
            finald[j].confirmed += x.confirmed;
            finald[j].recovered += x.recovered;
            finald[j].deaths += x.deaths
            ++j;
          }
        }
        }
        drawline(finald)
        // store.time=store.save
   }
  
  store.position=0
  store.currenthighlight=''
   ///command/////
   function command()
     {
       let str=document.getElementById('command').value.toLowerCase()
      //  document.getElementById('command').value="";



       if((/^(find|show)/).test(str) || (/maximum|minimum|highest|lowest/).test(str))
      {
        chk=false
        let a=[]
        store.currentcommand=str;
        if(str.includes("maximum")|| str.includes("highest"))
            {
              if(store.afterlasso.length>0)
              {
                
                if(str.includes("death") || str.includes("fatal"))
                {

                  chk=true
                   a=store.afterlasso.sort((a,b) => b.deaths - a.deaths);
                   d3.select(".res1").html("Maximum death cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries"); 
                }
                else if(str.includes("recovered") || str.includes("healing"))
                {
                  chk=true
                   a=store.afterlasso.sort((a,b) => b.recovered - a.recovered);
                   d3.select(".res1").html("Maximum recovered cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries"); 
                }
                else if(str.includes("confirmed"))
                {
                  chk=true
                   a=store.afterlasso.sort((a,b) => b.confirmed - a.confirmed);
                   d3.select(".res1").html("Maximum confirmed cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries"); 
                }
                
  
                
          
              }
              else if(1){
                if(str.includes("death") || str.includes("fatal"))
                {
                  chk=true
                   a=store.done.sort((a,b) => b.deaths - a.deaths);
                   d3.select(".res1").html("Maximum death cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"); 
                }
                else if(str.includes("recovered") || str.includes("healing"))
                {
                  chk=true
                   a=store.done.sort((a,b) => b.recovered - a.recovered);
                   d3.select(".res1").html("Maximum recovered cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"); 
                }
                else if(str.includes("confirmed"))
                {
                  chk=true
                   a=store.done.sort((a,b) => b.confirmed - a.confirmed);
                   d3.select(".res1").html("Maximum confirmed cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"); 
                }
                
                
              }
              
  
            }
            else if(str.includes("minimum") || str.includes("lowest"))
            {
              if(store.afterlasso.length>0)
              {
                
                if(str.includes("death")|| str.includes("fatal"))
                {
                  chk=true
                   a=store.afterlasso.sort((a,b) => a.deaths - b.deaths);
                   d3.select(".res1").html("Minimum death cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries");
                }
                else if(str.includes("recovered") || str.includes("healing"))
                {
                  chk=true
                 a=store.afterlasso.sort((a,b) => a.recovered - b.recovered);
                 d3.select(".res1").html("Minimum recovered cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries");
                }
                else if(str.includes("confirmed"))
                {
                  chk=true
                  a=store.afterlasso.sort((a,b) => a.confirmed - b.confirmed);
                  d3.select(".res1").html("Minimum confirmed cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>"+" among the selected countries");
                }
                 
          
              }
              else if(1)
              {
                if(str.includes("death")|| str.includes("fatal"))
                {
                  chk=true
                  a=store.done.sort((a,b) => a.deaths - b.deaths);
                  d3.select(".res1").html("Minimum death cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>");
                }
                else if(str.includes("recovered") || str.includes("healing"))
                {
                  chk=true
                 a=store.done.sort((a,b) => a.recovered - b.recovered);
                 d3.select(".res1").html("Minimum recovered cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>");
                }
                else if(str.includes("confirmed"))
                {
                  chk=true
                 a=store.done.sort((a,b) => a.confirmed - b.confirmed);
                 d3.select(".res1").html("Minimum confiremd cases occured in "+ "<span style='font-weight:bold;'>" + capitalizeFirstLetter(a[0].country) +"</span>");
                }
                
              }
              
            }
            if(!chk)call_error("max_min")
            else call_ShowResult()
  
           c=a[0].country
           ii=d3.select("#G").selectAll("circle")._groups[0];
            for( j=0;j<=180;j++){
              i=ii[j];
            if(currentvis=="confirmed"){
           if(i.__data__.country==c)
           {
            
             d3.select(i).attr("fill","yellow").transition().duration(1000).attr("r",radius(i.__data__.confirmed)+10).attr("fill","yellow").transition().duration(1000).attr("r",radius(i.__data__.confirmed))
               .transition().duration(1000).attr("r",radius(i.__data__.confirmed)+10).attr("fill","purple").transition().duration(1000).attr("r",radius(i.__data__.confirmed)).transition().duration(1000).attr("r",0).attr("fill","purple")
           }
            }
            else if(currentvis=="death"){
             if(i.__data__.country==c){
         d3.select(i).attr("fill","yellow").transition().duration(1000).attr("r",radius(i.__data__.deaths)+10).transition().duration(1000).attr("r",radius(i.__data__.deaths))
               .transition().duration(1000).attr("r",radius(i.__data__.deaths)+10).attr("fill","purple").transition().duration(1000).attr("fill","purple").attr("r",radius(i.__data__.deaths)).transition().duration(1000).attr("r",0).attr("fill","purple")
             }
            }
            else if(currentvis=="recovered"){
             if(i.__data__.country==c){
            d3.select(i).attr("fill","yellow").transition().duration(1000).attr("r",radius(i.__data__.recovered)+10).transition().duration(1000).attr("r",radius(i.__data__.recovered))
               .transition().duration(1000).attr("r",radius(i.__data__.recovered)+10).attr("fill","purple").transition().duration(1000).attr("r",radius(i.__data__.recovered)).transition().duration(1000).attr("r",).attr("fill","purple")
             }
            }
           }  
  
            l= d3.selectAll("rect")._groups[0]
            let ln=d3.selectAll("rect")._groups[0].length-6
       for(i=0;i<ln;i++)
       {
         if(l[i].__data__.country==a[0].country)
         {
           d3.select(l[i]).classed("selected1",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected1",false)
         }
       }
      
  
        l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         if(l[i].__data__.country==a[0].country)
         {
           d3.select(l[i]).classed("selected1",true)
         }
         else{
           d3.select(l[i]).classed("selected1",false)
         }
       }
       store.currenthighlight=a[0].country
       if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
  
                 
  
  
  
      }




       else if(((/^(select|show)/).test(str) && (/death cases|confirmed cases|recovered cases|fatal cases/).test(str) )|| (/death cases|confirmed cases|recovered cases|fatal cases/).test(str))
       {
         
        if(str.includes("death cases") || str.includes("fatal cases")){
              currentvis="death";
              document.getElementById("options").value="Death Cases"
            // document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
            d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.deaths - a.deaths));
            else  drawbar(store.done.sort((a,b)=>b.deaths - a.deaths));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCirclesdeath(store.done,"red")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
          
          
          
            }
            else if(str.includes("confirmed cases"))
        
            {
              currentvis="confirmed";
              document.getElementById("options").value="confirmed Cases"
            //   document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
              d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.confirmed - a.confirmed));
            else  drawbar(store.done.sort((a,b)=>b.confirmed - a.confirmed));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCircles(store.done,"blue")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
          //d3.select(".res").text("Showing Results of confirmed Cases for All Countries");
            }      
              else if(str.includes("recovered cases"))
            {
              currentvis="recovered";
              document.getElementById("options").value="Recovered Cases"
            //   document.getElementById("countries").value="All";
            // $("#countries").trigger("chosen:updated");
              d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso.sort((a,b)=>b.recovered - a.recovered));
            else  drawbar(store.done.sort((a,b)=>b.recovered - a.recovered));
            drawMap(prep(store.geoJSON))
            drawline(store.sumdate)
            drawCirclesRecovered(store.done,"red")
            total_case_print(groupbyCountry(store.coronadat))
          total_case_print1(groupbyCountryDeath(store.death))
          total_case_print2(groupbyCountryRecovered(store.recovered))
         // d3.select(".res").text("Showing Results of Recovered Cases for All Countries");
            }
  
            if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
  
    
          if(store.currentselectedcountries.length!=0)drawline(commandline(store.currentselectedcountries));
          call_ShowResult();
          let l=d3.select("#BarChart").selectAll("rect")._groups[0]
          let ln=d3.select("#BarChart").selectAll("rect")._groups[0].length-2
          let cn=''
          
          for(let i=0;i<ln;i++)
          {
            if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
            {
              cn=l[i].__data__.country.toLowerCase()
              break
            }
          }
          if(store.currentselectedcountries.length>0)scrollbar(cn)
          if(store.currentcommand!=null)
         {
           
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
          
       }
  
  
  
       
  
    
  
      else if((/from/).test(str) && (/to/).test(str))
      {
  

        
        let d=[]
        a=str;
        a=a.split(" ")
        for(i of a){
          if(i=="from" || i=="to")continue
          else d.push(i)
        }

        let t1=new Date(d[0])
        let t2=new Date(d[1])
        let ct1=new Date(store.intialstart)
        let ct2=new Date(store.intialend)


        if(!(t1.getTime()>=ct1.getTime() && t2.getTime()<=ct2.getTime()))
        {
          call_error("date")
        }
     else{
       ResultShow(store.currentselectedcountries,currentvis,d[0],d[1],store.currentcontinet);
       store.currentstartingdate=new Date(d[0])
       store.currentendigndate=new Date(d[1])
       let protom = new Date(slidedata[0].date).getTime()
          let suru= Math.abs(new Date(d[0])-protom)/86400000
          let ses = Math.abs(new Date(d[1])-protom)/86400000
          
          
         afterlasso(new Date(d[0]) ,new Date(d[1]))
        if(store.currentselectedcountries.length>0)sliderafterbarlasso(suru,ses,store.time)
        else drawline(slidedata.slice(suru,ses+1))
        slideraftervoice(d[0],d[1])
  
        if(store.currentcommand!=null)
        {
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
          str=store.currentcommand
          // document.getElementById('command').value="";
          if((/^(find|show)/).test(str) || (/maximum|minimum/).test(str))
      {
        
        let a=[]
        store.currentcommand=str;
        if(str.includes("maximum"))
            {
              if(store.afterlasso.length>0)
              {
                
                if(str.includes("death"))
                {
                  
                   a=store.afterlasso.sort((a,b) => b.deaths - a.deaths);
                   d3.select(".res1").text("maximum death cases occured in "+a[0].country+" among the selected countries"); 
                }
                else if(str.includes("recovered"))
                {
                   a=store.afterlasso.sort((a,b) => b.recovered - a.recovered);
                   d3.select(".res1").text("maximum recovered cases occured in "+a[0].country+" among the selected countries"); 
                }
                else if(str.includes("confirmed"))
                {
                   a=store.afterlasso.sort((a,b) => b.confirmed - a.confirmed);
                   d3.select(".res1").text("maximum confirmed cases occured in "+a[0].country+" among the selected countries"); 
                }
                
  
                
          
              }
              else if(1){
              
                if(str.includes("death"))
                {
                   a=store.done.sort((a,b) => b.deaths - a.deaths);
                   d3.select(".res1").text("maximum death cases occured in "+a[0].country); 
                }
                else if(str.includes("recovered"))
                {
                   a=store.done.sort((a,b) => b.recovered - a.recovered);
                   d3.select(".res1").text("maximum recovered cases occured in "+a[0].country); 
                }
                else if(str.includes("confirmed"))
                {
                   a=store.done.sort((a,b) => b.confirmed - a.confirmed);
                   d3.select(".res1").text("maximum confirmed cases occured in "+a[0].country); 
                }
                
                
              }
              
  
            }
            else if(str.includes("minimum"))
            {
              if(store.afterlasso.length>0)
              {
                
                if(str.includes("death"))
                {
                   a=store.afterlasso.sort((a,b) => a.deaths - b.deaths);
                   d3.select(".res1").text("minimum death cases occured in "+a[0].country+" among the selected countries");
                }
                else if(str.includes("recovered"))
                {
                 a=store.afterlasso.sort((a,b) => a.recovered - b.recovered);
                 d3.select(".res1").text("minimum recovered cases occured in "+a[0].country+" among the selected countries");
                }
                else if(str.includes("confirmed"))
                {
                  a=store.afterlasso.sort((a,b) => a.confirmed - b.confirmed);
                  d3.select(".res1").text("minimum confirmed cases occured in "+a[0].country+" among the selected countries");
                }
                 
          
              }
              else if(1)
              {
                if(str.includes("death"))
                {
                  a=store.done.sort((a,b) => a.deaths - b.deaths);
                  d3.select(".res1").text("minimum death cases occured in "+a[0].country);
                }
                else if(str.includes("recovered"))
                {
                 a=store.done.sort((a,b) => a.recovered - b.recovered);
                 d3.select(".res1").text("minimum recovered cases occured in "+a[0].country);
                }
                else if(str.includes("confirmed"))
                {
                 a=store.done.sort((a,b) => a.confirmed - b.confirmed);
                 d3.select(".res1").text("minimum confiremd cases occured in "+a[0].country);
                }
                
              }
              
            }
  
           c=a[0].country
           ii=d3.select("#G").selectAll("circle")._groups[0];
            for( j=0;j<=180;j++){
              i=ii[j];
            if(currentvis=="confirmed"){
           if(i.__data__.country==c)
           {
            
             d3.select(i).transition().duration(1000).attr("r",radius(i.__data__.confirmed)+15).attr("fill","red").transition().duration(1000).attr("r",radius(i.__data__.confirmed))
               .transition().duration(1000).attr("r",radius(i.__data__.confirmed)+15).transition().duration(1000).attr("r",radius(i.__data__.confirmed)).transition().duration(1000).attr("r",0).attr("fill","blue")
           }
            }
            else if(currentvis=="death"){
             if(i.__data__.country==c){
         d3.select(i).transition().duration(1000).attr("r",radius(i.__data__.deaths)+10).attr("fill","red").transition().duration(1000).attr("r",radius(i.__data__.deaths))
               .transition().duration(1000).attr("r",radius(i.__data__.deaths)+10).transition().duration(1000).attr("r",radius(i.__data__.deaths)).transition().duration(1000).attr("r",0).attr("fill","red")
             }
            }
            else if(currentvis=="recovered"){
             if(i.__data__.country==c){
            d3.select(i).transition().duration(1000).attr("r",radius(i.__data__.recovered)+10).attr("fill","red").transition().duration(1000).attr("r",radius(i.__data__.recovered))
               .transition().duration(1000).attr("r",radius(i.__data__.recovered)+10).transition().duration(1000).attr("r",radius(i.__data__.recovered)).transition().duration(1000).attr("r",).attr("fill","green")
             }
            }
           }  
  
            l= d3.selectAll("rect")._groups[0]
            let ln=d3.selectAll("rect")._groups[0].length-6
       for(i=0;i<ln;i++)
       {
         if(l[i].__data__.country==a[0].country)
         {
           d3.select(l[i]).classed("selected1",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected1",false)
         }
       }
      
  
        l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         if(l[i].__data__.country==a[0].country)
         {
           d3.select(l[i]).classed("selected1",true)
         }
         else{
           d3.select(l[i]).classed("selected1",false)
         }
       }
       store.currenthighlight=a[0].country
       if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
  
                 
  
  
  
      }
        }
     }
  
      //  for (i=0;i<d3.select("#container").selectAll('circle')._groups[0].length -1 ;i++)
      //  {
      //    let b=d3.select("#container").selectAll('circle')._groups[0][i]
      //   if( b.__data__.date>=new Date(d[0]) && b.__data__.date<=new Date(d[1]) && b.getAttribute("case")==currentvis)
      //   {
      //     d3.select(b).classed("selected",true)
      //             .attr("r",2)
      //             .style("fill", "yellow");
      //     //console.log(b)
  
          
          
          
      //   }
      //  }
  
    //  store.afterlasso=[]
    //    l= d3.selectAll("rect")._groups[0]
    //       ln=d3.selectAll("rect")._groups[0].length
    //       for(i=0;i<ln;i++)
    //    {
    //      store.afterlasso.push(l[i].__data__);
    //    }
  
      
        
      }
      else if(((/^select/).test(str)&&(/asia|north america|south america|africa|oceania|antarctica|europe/).test(str) && !str.includes("south africa")) || ((/asia|north america|south america|africa|oceania|antarctica|europe/).test(str) && !str.includes("south africa")))
      {
        let cntnt=["asia","north america","south america","africa","oceania","antarctica","europe"]
        let c=0;
        for(i of cntnt)
        {
            if(str.indexOf(i)>=0)c+=1;
            if(c>=2)break;
        }
        if(c>1)call_error("continent")
        else{
           if(str.includes("asia"))
           {
            store.currentcontinet="Asia"
             continent_postprocessing("asia")
  
           
           
           }
           else if(str.includes("europe"))
           {
            store.currentcontinet="Europe"
             continent_postprocessing("europe")         
   
           }
           else if(str.includes("north america"))
           {
            store.currentcontinet="North America"
             continent_postprocessing("north_america")
           }
           else if(str.includes("south america"))
           {
            store.currentcontinet="South America"
             continent_postprocessing("south_america") 
           }
           else if(str.includes("oceania"))
           {
            store.currentcontinet="Australia/Oceania"
             continent_postprocessing("oceania")
           }
           else if(str.includes("africa"))
           {
             store.currentcontinet="Africa"
             continent_postprocessing("africa")
           }
           call_ShowResult()
           if(store.currentcommand!=null)
         {
           
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
        }
           
      }
       


      else if((/clear|cls|clear all/).test(str))
       {
          cls(); 
       }

       else if((/^select/).test(str) || 1){
         console.log("aslam")
          
          a= str.split(",")
          a[0]=a[0].replace("select ","")
          store.currentcontinet=null
          
          
          for(let i=0;i<a.length;i++)
          {
            a[i]=a[i].trim()
            if(a[i]=="uk")a[i]="united kingdom"
            if(a[i]=="uae")a[i]="united arab emirates"
          }
          // console.log(a)
          
          if(a[0].toLowerCase()!="all"){
            dp=''
          
  
            if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
  
       for(i=0;i<store.done.length;i++)
       {
         if(a.includes( store.done[i].country.toLowerCase()))
         {
          dp=store.done[i].country
          break;
  
         }
       }
           scrollbar(dp)
  
          }
  //akane kaj korte hobe scrollbar after lasso line up
        
        
  
   if(a[0]=="all") 
   {
     
     store.currentselectedcountries=[]
     if(store.currentstartingdate==null && store.currentendigndate==null){
     var stdate = slidedata[0].date, endate = slidedata[slidedata.length-1].date; // we are here
     ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet);
     drawline(slidedata);
     }
     else{
      
      let ddd = new Date(slidedata[0].date).getTime()
          let s = Math.abs(store.currentstartingdate-ddd)/86400000
          let e = Math.abs(store.currentendigndate-ddd)/86400000
     ResultShow(store.currentselectedcountries,currentvis,store.currentstartingdate,store.currentendigndate,store.currentcontinet);
    drawline(slidedata.slice(s,e+1));
     }
     document.getElementById("countries").value="All"
     $("#countries").trigger("chosen:updated");
     clearbar()
     drawbar(store.done)
     highlight_show_top_result_call_command();
   }
   else{ 
     let ck=true;
     for(i of a)
     {
       if(!store.lowercountries.includes(i.toLowerCase()))ck=false
      
     }

    
  if(ck){
   document.getElementById("countries").value="selected from other interactions"
     $("#countries").trigger("chosen:updated");
     store.currentselectedcountries=a;
     call_ShowResult();
        // drawline(commandline(a))
        highlight_show_top_result_call_command();
   }
   else {
     call_error(str)
   }
   }
  
      
        
  
    
       }
  
       spreadsheet("Command")
       
       
     }
  
     //after lasso
  
     function scrollbar(data)
     {
      let k=0
      flag=true
      if(store.afterlinelasso.length==store.done.length)
      {
        console.log(data)
        if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
          else if(currentvis=="death") store.done.sort((a,b) => b.deaths - a.deaths);
          else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
        g=[]
        for(j of store.afterlinelasso)g.push(j.country.toLowerCase())
        for(i of g)
         {
           k++;
          if( i==data.toLowerCase()) 
          {
            console.log(i.country)
            console.log(k)
            flag=false
            break;
          }
         }
      }
  
      else{
        for(i of store.done)
         {
           k++;
          if( i.country.toLowerCase()==data.toLowerCase())
          {
            console.log(i.country)
            console.log(k)
            flag=false
            break;
          }
         }
      }
        if(flag)k=0
       store.position=k+k*.9 
       store.scroll=true
       clearbar()
      if(store.afterlinelasso.length==store.done.length) drawbar(store.afterlinelasso);
      else  drawbar(store.done);
       store.position=0
       store.scroll=false
     }
  store.afterlinelasso=[]
     function afterlasso(d1,d2){
                
          //  console.log(d1,d2)
          var d3 = new Date(slidedata[0].date).getTime()
          var str = Math.abs(d1-d3)/86400000
          var end = Math.abs(d2-d3)/86400000
          let a = [];
          
          str = Math.floor(str)
          end = Math.floor(end)
          var j = 0;
          //console.log(store.time)
          // console.log(str,end)
        
          for( x of store.time){
            let c=0;
            let d=0;
            let r=0;
  
            if(str==0){
              c += x.values[end].confirmed
               d += x.values[end].deaths
               r += x.values[end].recovered
  
            }
            else{
            
               c += x.values[end].confirmed - x.values[str].confirmed
               d += x.values[end].deaths - x.values[str].deaths
               r += x.values[end].recovered - x.values[str].recovered
            }
            
            a[j] = {
              "country" : x.values[0].country,
              "confirmed" : c,
              "recovered" : r,
              "deaths" : d,
              "date" :   x.values[end].date       }
            j++;
          }
  
          
          if(currentvis=="confirmed")a = a.sort((a,b)=>b.confirmed-a.confirmed);
          else if(currentvis=="death")a = a.sort((a,b)=>b.deaths - a.deaths);
          else if(currentvis=="recovered")a = a.sort((a,b)=>b.recovered -a.recovered)
          
  
  
          
            for(i=0;i<a.length;i++)
            {
                
                b=a[i].country;
                // a[i].deaths=k[i].deaths;
                // a[i].recovered=z[i].recovered;
                if(b=="US"){
                    b="United States of America"
                }
                else if(b=="Tanzania")
                {
                  b="United Republic of Tanzania" 
                }
                else if(b=="Congo (Kinshasa)")
                {
                  b="Democratic Republic of the Congo"
                }
                else if(b=="Congo (Brazzaville)")
                {
                  b="Republic of the Congo"
                }
                else if(b=="Cote d'Ivoire")
                {
                  b="Ivory Coast"
                }
                else if(b=="Burma")
                {
                  b="Myanmar"
                }
                else if(b=="Korea, South")
                {
                  b="South Korea"
                }
                else if(b=="Taiwan*")
                {
                  b="Taiwan"
                }
                else if(b=="Czechia")
                {
                  b="Czech Republic"
                }
                else if(b=="Serbia")
                {
                  b="Republic of Serbia"
                }
                for (j of store.mapafterlinelasso.features)
                {
                    if(j.properties.name==b)
                    {
                        j.confirmed=a[i].confirmed;
                        j.deaths=a[i].deaths;
                        j.recovered=a[i].recovered;
                        j.country=a[i].country
                        j.date=a[i].date
                        break;
                    }
                    else {
                      if(!('country' in j))
                      {
                        j.country=""
                      }
                    }
                    
                }
            }
            for (i of store.mapafterlinelasso.features)
            {
                if(!('confirmed' in i)){
                    i.confirmed=0;
                    i.deaths=0
                    i.recovered=0
                    i.date=null
                }
            }
  
            // console.log(a)
  
            total_case_print(a);
            total_case_print1(a);
            total_case_print2(a);
            
            clearmap()
            drawMap(store.mapafterlinelasso)
  
          clearbar()
          drawbar(a)
  store.afterlinelasso=a
  if(store.currentselectedcountries.length!=0)
  {
    bc=0
    if(currentvis=="confirmed")a=a.sort((a,b)=>b.confirmed - a.confirmed);
    else if(currentvis=="death")a=a.sort((a,b)=>b.deaths - a.deaths);
    else if(currentvis=="recovered")a=a.sort((a,b)=>b.recovered - a.recovered);
    for(g=0;g<a.length;g++)
    {
      if(store.currentselectedcountries.includes(a[g].country.toLowerCase()))
      {
        bc=g
        console.log(a[g].country)
        break;
      }
    }
   store.scroll=true
   store.position=bc+bc*.9
   clearbar()
   drawbar(a)
   store.scroll=false
   store.position=0
  }
           drawCircles(store.done,"red")
       drawCirclesRecovered(store.done,"red")
       drawCirclesdeath(store.done,"red")
  
  
      rehiglight()
  
  
       recalibrate()
          
          
         
     }
  
     function rehiglight()
     {
  
  
  
      let l= d3.selectAll("rect")._groups[0]
        let ln=d3.selectAll("rect")._groups[0].length-6
       for(i=0;i<ln;i++)
       {
        
        
         if(store.currentselectedcountries.includes(l[i].__data__.country) || store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
         {
           
          
           d3.select(l[i]).classed("selected",true)
          
  
         }
         else{
           d3.select(l[i]).classed("selected",false)
         }
       }
  
     }
    
  
    function recalibrate()
    {
      let a=[]
      let b=[]
      let c=[]
      for(let i=0;i<store.afterlasso.length;i++)
      {
        
        if(store.afterlasso[i].country!=null)a.push(store.afterlasso[i].country)
      }
      store.afterlasso=[]
       l= d3.selectAll("rect")._groups[0]
          ln=d3.selectAll("rect")._groups[0].length-6
          for(i=0;i<ln;i++)
       {
         if(a.includes(l[i].__data__.country)){
          b.push(l[i].__data__);
         }
         c.push(l[i].__data__)
         if(b.length!=0)store.afterlasso=b;
         else store.afterlasso=c;
         
       }
       if(store.afterlasso.length!=207)
       {
        var uniqueNames = [];
  $.each(store.afterlasso, function(i, el){
      if($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
  });
    store.afterlasso=uniqueNames
       }
       
    }
  
  
    function clearmap()
    {
      d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
    }
     //end after lasso
     // after bar lasso
  
      function afterbarlasso(data){
        var pdata = []
        var finald = []
        let i = 0;
        if(store.currentstartingdate==null && store.currentendigndate==null){
        for(x of data ){
          for (d of store.time){
            
                if(x.__data__.country == d.key){
                  pdata[i] = d.values;
                  break;
                }
           }
        
           ++i;
      }
        }
      else{
        var dd = new Date(slidedata[0].date).getTime()
          let st=new Date(store.currentstartingdate)
          let en=new Date(store.currentendigndate)
          var s = Math.abs(st-dd)/86400000
          var e = Math.abs(en-dd)/86400000
        for(x of data ){
          for (d of store.time){
            
                if(x.__data__.country == d.key){
                  pdata[i] = d.values.slice(s,e);
                  break;
                }
           }
        
           ++i;
      }
  
      }
      i=0;
        //console.log(pdata)
        for( x of pdata[0]){
          finald[i] = {
              "confirmed" : x.confirmed,
              "recovered" : x.recovered,
              "deaths" : x.deaths,
              "date" :   x.date 
          }
          ++i;
        }
  
        for( var k =1; k< pdata.length; ++k){
          let j=0;
          for( x of pdata[k]){
            finald[j].confirmed += x.confirmed;
            finald[j].recovered += x.recovered;
            finald[j].deaths += x.deaths
            ++j;
          }
        }
        
        drawline(finald)
      }
  
  
      function aftermaplasso(data){
        var pdata = []
        var finald = []
        let i = 0;
        if(store.currentstartingdate==null && store.currentendigndate==null){
        for(x of data ){
          for (d of store.time){
            
                if(x.country == d.key){
                  pdata[i] = d.values;
                  break;
                }
           }
        
           ++i;
      }
        }
      else{
        var dd = new Date(slidedata[0].date).getTime()
          let st=new Date(store.currentstartingdate)
          let en=new Date(store.currentendigndate)
          var s = Math.abs(st-dd)/86400000
          var e = Math.abs(en-dd)/86400000
          for(x of data ){
          for (d of store.time){
            
                if(x.country == d.key){
                  pdata[i] = d.values.slice(s,e);
                  break;
                }
           }
        
           ++i;
      }
      }
      i=0;
        
        for( x of pdata[0]){
          finald[i] = {
              "confirmed" : x.confirmed,
              "recovered" : x.recovered,
              "deaths" : x.deaths,
              "date" :   x.date 
          }
          ++i;
        }
        console.log(pdata.length)
        for( var k =1; k< pdata.length; ++k){
          let j=0;
          if(pdata[k]!=null){
          for( x of pdata[k]){
            finald[j].confirmed += x.confirmed;
            finald[j].recovered += x.recovered;
            finald[j].deaths += x.deaths
            ++j;
          }
        }
        }
        drawline(finald)
      }
  
     //end bar lasso
        
  // clear bar
  
     function clearbar(){
      document.getElementById("BarChart").innerHTML="";
     }
  
     function commandline(a)
     {
      var pdata = []
        var finald = []
        
      if(store.currentstartingdate==null && store.currentendigndate==null){
         let l=[]
         
          for(i of store.time)
          {
            
            if(a.includes(i.key.toLowerCase()))
            {
              pdata.push(i.values)
              l.push(i.key.toLowerCase())
            }
            
          }
          // console.log(store.asia.filter(t=> !l.includes(t)))
      }
      else{
        var dd = new Date(slidedata[0].date).getTime()
          let st=new Date(store.currentstartingdate)
          let en=new Date(store.currentendigndate)
          var s = Math.abs(st-dd)/86400000
          var e = Math.abs(en-dd)/86400000
          e=e+1
          for(i of store.time)
          {
            if(a.includes(i.key.toLowerCase()))
            {
              pdata.push(i.values.slice(s,e))
            }
            
          }
  
      }
    //  console.log("pdata")
     console.log(pdata)
    
      i=0;
        
        for( x of pdata[0]){
          finald[i] = {
              "confirmed" : x.confirmed,
              "recovered" : x.recovered,
              "deaths" : x.deaths,
              "date" :   x.date 
          }
          ++i;
        }
  
        for( var k =1; k< pdata.length; ++k){
          let j=0;
          if(pdata[k]!=null){
          for( x of pdata[k]){
            finald[j].confirmed += x.confirmed;
            finald[j].recovered += x.recovered;
            finald[j].deaths += x.deaths
            ++j;
          }
        }
        }
        return finald;
     }
  
  //end
  
  //////pop up/////
  var modal = document.getElementById("myModal");
  
  // Get the button that opens the modal
  var btn = document.getElementById("myBtn");
  
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  
  var reset=document.getElementById("reset");
  
  var input = document.getElementById("command");
  
  // Execute a function when the user releases a key on the keyboard
  input.addEventListener("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    
    document.getElementById("command").placeholder="Enter query here"
    
    command()
  }
  });
  
  // When the user clicks the button, open the modal 
  btn.onclick = function() {
    modal.style.display = "block";
  }
  
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.display = "none";
  }
  
  reset.onclick = function(){
  
       
    cls();     
            
       
  }
  
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
  ///end  pop up/////
  
  
  
  //////voice recognition ///////
  
  
  var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
  var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;
  
  var grammar = '#JSGF V1.0;'
  
  var recognition = new SpeechRecognition();
  var speechRecognitionList = new SpeechGrammarList();
  speechRecognitionList.addFromString(grammar, 1);
  recognition.grammars = speechRecognitionList;
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  
  recognition.onresult = function(event) {
      var last = event.results.length - 1;
      var command1 = event.results[last][0].transcript;
     // message.textContent = 'Voice Input: ' + command + '.';
     
  
     let str=command1.toLowerCase()
     
     
     if(str.includes("depth"))
     {
       str=str.replace("depth","death")
     }
     if(str.includes("showuth america"))str="south america"
    //  if(str.includes("showuth"))str=str.replace("showuth","south")
     if(str.includes("conference"))str=str.replace("conference","confirmed")
     if(str.includes("sylhet"))str=str.replace("sylhet","select")
     if(str.includes("so"))str=str.replace("so","show")
     if(str.includes("showuth"))str=str.replace("showuth","south")
     if(str.includes("osmania"))str=str.replace("osmania","oceania")
     if(str.includes("o showniya"))str=str.replace("o showniya","oceania")
     if(str.includes("usnea"))str=str.replace("usnea","oceania")
     if(str.includes("united kingdom"))str=str.replace("united kingdom","uk")
     if(str.includes("united states of america"))str=str.replace("united states of america","us")
     if(str.includes("united arab emirates"))str=str.replace("united arab emirates","uae")

     if(str.includes("select") && !(/death|recovered|confirmed|healing|fatal/).test(str))
     {
       
       str=str.replace(/[ ,]+/g, ",").trim(" ")
       str=str.replaceAt(6," ");
      
       
     }
     let j;
     if(!str.includes("select")){
     for(i of store.lowercountries)
     {
       j=i;
       if(i=="united kingdom")j="uk"
       if(i=="united arab emirates")j="uae"

       if(str.indexOf(j)>=0)
       {
        str=str.replace(/[ ,]+/g, ",").trim(" ")
         break;
       }
       
     }
     
     }
     if(str.includes("saudi,arabia"))str=str.replace("saudi,arabia","saudi arabia")
     
     document.querySelector('#command').value=str
  
     command()
     
  
  };
  
  
  recognition.onspeechend = function() {
      recognition.stop();
      // setTimeout(function(){ recognition.start(); }, 400);
  };
  
  recognition.onerror = function(event) {
      message.textContent = 'Error occurred in recognition: ' + event.error;
  }        
  
  
  document.querySelector('#button').addEventListener('click', function(){
    recognition.start();
  })
  
  
  String.prototype.replaceAt=function(index, replacement) {
      return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
  }
  
  //end of voice recogition
  
  
  function slideraftervoice(x1,x2){
      {
  
        stdate = x1
        endate = x2
    var len = slidedata.length
    $(function() {
      $( "#slider-range" ).slider({
        range: true,
        min: new Date(slidedata[0].date).getTime() / 1000,
        max: new Date(slidedata[len-1].date).getTime() / 1000,
        step: 86400,
        values: [ new Date(x1).getTime() / 1000, new Date(x2).getTime() / 1000 ],
        slide: function( event, ui ) { //console.log((new Date(ui.values[ 0 ] *1000) ))
          var d1 = new Date(ui.values[ 0 ] *1000)
          var d2 = new Date(ui.values[ 1 ] *1000)
          var d3 = new Date(slidedata[0].date).getTime()
          var str = Math.abs(d1-d3)/86400000
          var end = Math.abs(d2-d3)/86400000
          stdate = d1
          endate = d2
          store.currentstartingdate=stdate
          store.currentendigndate=endate
          afterlasso(d1, d2)
          if(store.currentselectedcountries.length!=0)
          {
            //akane kaj kor//
            ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet);
            sliderafterbarlasso(str,end,store.time)
          }
          else{ 
            ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet);
            drawline(slidedata.slice(str,end+1))}
          if(store.currentcommand!=null){
            let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
          }
          spreadsheet("Date Range Slider")
          console.log(new Date(ui.values[ 1 ] *1000).toDateString())
          $( "#amount" ).val( (new Date(ui.values[ 0 ] *1000).toDateString() ) + " - " + (new Date(ui.values[ 1 ] *1000)).toDateString() );
        }
      });
      $( "#amount" ).val( (new Date($( "#slider-range" ).slider( "values", 0 )*1000).toDateString()) +
        " - " + (new Date($( "#slider-range" ).slider( "values", 1 )*1000)).toDateString());
        
    });
   }
   
    }
        //new
  
        // result show function
  
      function ResultShow(countries,cases, stdate,endate,cnt){
          var cases;
          // if(currentvis == "confirmed"){
          //     cases = "confirmed case"
          // }
          // else if (currentvis == "death"){
          //    cases == "death case"
          // }
          // else{
          //   cases = "Recovered case"
          // }
          
          var date1 = new Date(stdate);
          var date2 = new Date(endate)
          var coutrylist=" ";
          var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
          if(cnt!=null)
          {
            d3.select("#res").html("Showing "+cases+" cases "+" for All Countries of "+cnt+" from "+date1.getDate()+" of "+months[date1.getMonth()]
            +" to "+date2.getDate()+" of "+months[date2.getMonth()]+".")
          }
         else if(countries.length == 0){
          d3.select("#res").html("Showing "+cases+" cases "+" for All Countries from "+date1.getDate()+" of "+months[date1.getMonth()]
            +" to "+date2.getDate()+" of "+months[date2.getMonth()]+".")
          }
          else if(countries.length<= 5){
            for(var i=0; i<countries.length; ++i){
                if(i==countries.length-1)
                {
                  coutrylist += capitalizeFirstLetter(countries[i])+' ';
                }
                else coutrylist += capitalizeFirstLetter(countries[i])+',';
            }
            d3.select("#res").html("Showing "+cases+" cases "+" for"+coutrylist+"from "+date1.getDate()+" of "+months[date1.getMonth()]
            +" to "+date2.getDate()+" of "+months[date2.getMonth()]+".")
          }
          else{
            coutrylist=" "
            for(var i=0; i<5; ++i){
              if(i==4)
                {
                  coutrylist += capitalizeFirstLetter(countries[i])+',... ';
                }
                else coutrylist += capitalizeFirstLetter(countries[i])+',';
            }
            d3.select("#res").html("Showing "+cases+" cases "+" for"+coutrylist+"from "+date1.getDate()+" of "+months[date1.getMonth()]
            +" to "+date2.getDate()+" of "+months[date2.getMonth()]+".")
          }
      }
  
        //end result show
  
      function call_ShowResult()
      {
        if(store.currentstartingdate==null && store.currentendigndate==null)
        {
          var stdate = slidedata[0].date, endate = slidedata[slidedata.length-1].date; // we are here
          ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet)
        }
        else{
          afterlasso(store.currentstartingdate,store.currentendigndate)
          ResultShow(store.currentselectedcountries,currentvis,store.currentstartingdate,store.currentendigndate,store.currentcontinet);
  
        }
      }
  
      function highlight_show_top_result_call_command()
      {
        let l=d3.select("#BarChart").selectAll('rect')._groups[0]
           let ln=d3.select("#BarChart").selectAll('rect')._groups[0].length-1;
           let d=[]
  
           for(let i=0;i<ln;i++)
           {
             if(store.currentselectedcountries.includes(l[i].__data__.country.toLowerCase()))
             {
               d.push(l[i].__data__);
               d3.select(l[i]).classed("selected1",false);
               d3.select(l[i]).classed("selected",true);
               
             }
             else{
              d3.select(l[i]).classed("selected1",false);
              d3.select(l[i]).classed("selected",false);
             }
             
           }
  
           let l1=d3.select("#G").selectAll("path")._groups[0]
           let ln1=180
  
           for(let i=0;i<ln1;i++)
           {
             if(store.currentselectedcountries.includes(l1[i].__data__.country.toLowerCase()))
             {
              d3.select(l1[i]).classed("selected1",false);
               d3.select(l1[i]).classed("selected",true);
               
             }
             else{
              d3.select(l1[i]).classed("selected1",false);
              d3.select(l1[i]).classed("selected",false);
             }
             
           }
  
           d.splice(0,d.length/2);
           store.afterlasso=d
           total_case_print(d)
           total_case_print1(d)
           total_case_print2(d)
           drawline(commandline(store.currentselectedcountries))
  
           if(store.currentcommand!=null)
         {
          let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
         }
      }
  
      function resort()
      {
        if(currentvis=="confirmed")store.done.sort((a,b) => b.confirmed - a.confirmed);
       else if(currentvis=="death")store.done.sort((a,b) => b.deaths - a.deaths);
       else if(currentvis=="recovered")store.done.sort((a,b) => b.recovered - a.recovered);
      }
  
      function cls()
      {
        document.getElementById("command").value=""
        currentvis="confirmed";
                    document.getElementById("options").value="confirmed Cases"
        document.getElementById("countries").value="All"
     $("#countries").trigger("chosen:updated");
         store.currentcommand=null
         store.currentselectedcountries=[]
         store.currenthighlight=''
         store.afterlasso=[]
         store.afterlinelasso=[]
         store.currentstartingdate=null
         store.currentendigndate=null
         store.currentcontinet=null
         let bar;
  
         document.getElementById("res1").innerHTML=" ";
        //  document.getElementById("options").value="confirmed Cases";
        
        if(currentvis=="confirmed")bar= store.done.sort((a,b) => b.confirmed - a.confirmed);
          else if(currentvis=="death")bar= store.done.sort((a,b) => b.deaths - a.deaths);
          else if(currentvis=="recovered")bar= store.done.sort((a,b) => b.recovered - a.recovered);
  
  
          var stdate = slidedata[0].date, endate = slidedata[slidedata.length-1].date; // we are here
          ResultShow(store.currentselectedcountries,currentvis,stdate,endate,store.currentcontinet)
  
         store.afterlasso=[]
        slideraftervoice(store.time[0].values[0].date,store.time[0].values[store.time[0].values.length-1].date)
        
  
       
            
            d3.select("#G").remove()
            d3.select("#Map").append("g").attr("id","G")
            d3.select("#BarChart").remove()
            d3.select("#Bar").append("svg").attr("id","BarChart").attr("transform", "rotate(90)")
            drawline(store.sumdate)
        clearbar()
        drawbar(bar)
        clearmap()
        drawMap(prep(store.geoJSON))
  
        l= d3.selectAll("rect")._groups[0]
       for(i=0;i<205;i++)
       {
         
          d3.select(l[i]).classed("selected1",false)
           d3.select(l[i]).classed("selected",false)
       }
      
          d=store.done
          total_case_print(d)
        total_case_print1(d)
        total_case_print2(d)
  
        l= d3.select("#G").selectAll("path")._groups[0]
       for(i=0;i<180;i++)
       {
         
           d3.select(l[i]).classed("selected",false)
           d3.select(l[i]).classed("selected1",false)
         
       }
  
       if(currentvis=="confirmed")drawCircles(store.done,"blue");
       else if(currentvis=="death")drawCirclesdeath(store.done,"red")
       else if(currentvis=="recovered")drawCirclesRecovered(store.done,"red")
       
      }
  
      function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }
  
  function groupbycontinet()
  {
    store.asia=continentgroup("Asia")
    store.north_america=continentgroup("North America")
    store.africa=continentgroup("Africa")
    store.oceania=continentgroup("Oceania")
    store.south_america=continentgroup("South America")
    store.europe=continentgroup("Europe")
    store.antarctica=continentgroup("Antarctica")
  }
  function continentgroup(data)
  {
    let l=[]
    for(i of store.continent)
    {
         if(i.continent==data)l.push(i.country.toLowerCase())
    }
    return l;
  }
  
  function continent_postprocessing(data)
  {
    let d=[]
             let cn=[]
             let l=d3.select("#BarChart").selectAll('rect')._groups[0]
           let ln=d3.select("#BarChart").selectAll('rect')._groups[0].length-1;
  
           for(let i=0;i<ln;i++)
           {
             if(store[data].includes(l[i].__data__.country.toLowerCase()))
             {
              d3.select(l[i]).classed("selected1",false);
               d3.select(l[i]).classed("selected",true);
               cn.push(l[i].__data__.country.toLowerCase())
               d.push(l[i].__data__)
             }
             else{
              d3.select(l[i]).classed("selected1",false);
              d3.select(l[i]).classed("selected",false);
             }
             
           }
           cn=cn.filter((v,i)=>cn.indexOf(v)==i)
           store.currentselectedcountries=cn
           resort()
           for(m of store.done)
           {
             if(cn.includes(m.country.toLowerCase()))
             {
               scrollbar(m.country.toLowerCase())
               break;
             }
  
           }
           
  
  
           let l1=d3.select("#G").selectAll("path")._groups[0]
           let ln1=180
  
           for(let i=0;i<ln1;i++)
           {
             if(store.currentselectedcountries.includes(l1[i].__data__.country.toLowerCase()))
             {
              d3.select(l1[i]).classed("selected1",false);
               d3.select(l1[i]).classed("selected",true);
               
             }
             else{
              d3.select(l1[i]).classed("selected1",false);
              d3.select(l1[i]).classed("selected",false);
             }
             
           }
  
           
           
           d=d.filter((v,i)=>d.indexOf(v)==i)
           
           store.afterlasso=d
           total_case_print(d)
           total_case_print1(d)
           total_case_print2(d)
           drawline(commandline(cn))
  
           if(store.currentcommand!=null)
           {
            let temp=document.getElementById('command').value
           document.getElementById('command').value=store.currentcommand;
           command();
           document.getElementById('command').value=temp;
           }
  }
  
  function addcomma( num ) {
    var str = num.toString()
    if (str.length >= 5) {
        str = str.replace(/(\d)(?=(\d{3})+$)/g, '$1,');
    }
    return str
}

function call_error(str)
{
  if(str=="max_min")
  {
    d3.select(".res").html("<span style='color:red;'>"+"Please mention the case. Ex: 'maximum death cases'"+"</span>")
  d3.select(".res1").html("")
  }
  else if(str=="date")
  {
    d3.select(".res").html("<span style='color:red;'>"+"Please choose a date range between "+store.intialstart+" and "+store.intialend+ " and enter the date in the format 'MM/DD/YY'"+". Ex: 'from 1/22/20 to 4/1/20'"+"</span>")
  d3.select(".res1").html("")

  }
  else if(str=="continent")
  {
    d3.select(".res").html("<span style='color:red;'>"+"Multiple continents can't be selected at a time"+"</span>")
  d3.select(".res1").html("")
  }
  else{
  ck=true
  for(i of store.lowercountries)
  {
    if(str.indexOf(i)>=0)
    {
      ck=false
      break
    }
  }
  if(ck){
  d3.select(".res").html("<span style='color:red;'>"+"Invalid Query"+"</span>")
  d3.select(".res1").html("")}
  else{
    d3.select(".res").html("<span style='color:red;'>"+"Invalid Query.To select countries using voice command use 'select' keyword.Ex: 'select uk us uae china india'"+"</span>")
  d3.select(".res1").html("")
  }
  }
}

function spreadsheet(action)
{
  $.ajax({
    url : "https://docs.google.com/forms/d/e/1FAIpQLSdFTl1GEdxl43kt91WDp-biXttwSObA2iy2xvw07DXR8REvmA/formResponse?",
    data : {"entry.1624828646":uid,"entry.474233433":action,"entry.1498295907":store.currentcommand,"entry.1125248345":store.currentstartingdate,"entry.686906836":store.currentendigndate,"entry.1826003622":store.currentselectedcountries.join(','),"entry.658702490":currentvis},
    type: "POST",
    dataType : "xml",
    success : function(d)
    {

    },
    error : function(x,y,z)
    {

    }


  });
  return false;
}

function makeRandomId()
{
  var text = "";
  var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

  for( var i=0; i < 7; i++ )
    text += possible.charAt(Math.floor(Math.random() * possible.length));

  return text;
}

        </script>
    </html>
  
